<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Clustering with BayesSpace — runBayesSpaceClustering • SPATA2</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Clustering with BayesSpace — runBayesSpaceClustering"><meta property="og:description" content="A wrapper around the BayesSpace clustering pipeline introduced
by Zhao et al. (2021)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SPATA2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/installation.html">Installation</a>
</li>
<li>
  <a href="../articles/spata-data.html">SPATAData</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li class="dropdown-header">Initiating a SPATA2 object</li>
    <li>
      <a href="../articles/initiation-and-preprocessing-customized.html">Initiation &amp; Preprocessing with individual data</a>
    </li>
    <li>
      <a href="../articles/initiation-and-preprocessing-merfish.html">Initiation &amp; Preprocessing with MERFISH data</a>
    </li>
    <li>
      <a href="../articles/initiation-and-preprocessing-visium.html">Initiation &amp; Preprocessing with Visium data</a>
    </li>
    <li>
      <a href="../articles/initiation-and-preprocessing-visium-hd.html">Initiation &amp; Preprocessing with VisiumHD data</a>
    </li>
    <li class="dropdown-header">Basic Manipulation of a SPATA2 object</li>
    <li>
      <a href="../articles/adding-data.html">Adding Data to SPATA2 objects</a>
    </li>
    <li>
      <a href="../articles/package-compatibility.html">Platform Compatibility</a>
    </li>
    <li>
      <a href="../articles/molecular-variables.html">Molecular Variables</a>
    </li>
    <li>
      <a href="../articles/image-handling.html">Image Handling</a>
    </li>
    <li>
      <a href="../articles/spatial-segmentation.html">Spatial Segmentation</a>
    </li>
    <li class="dropdown-header">Implemented Algorithms &amp; Concepts</li>
    <li>
      <a href="../articles/cnv.html">Copy Number Variations</a>
    </li>
    <li>
      <a href="../articles/clustering.html">Clustering</a>
    </li>
    <li>
      <a href="../articles/dimensional-reduction.html">Dimensional Reduction</a>
    </li>
    <li>
      <a href="../articles/dea.html">Differential Expression</a>
    </li>
    <li>
      <a href="../articles/gsea.html">Gene Set Enrichment</a>
    </li>
    <li>
      <a href="../articles/spatial-measures.html">Spatial Measures</a>
    </li>
    <li class="dropdown-header">Spatial Gradient Screening</li>
    <li>
      <a href="../articles/creating-spatial-annotations.html">Creating Spatial Annotations</a>
    </li>
    <li>
      <a href="../articles/using-spatial-annotations.html">Using Spatial Annotations</a>
    </li>
    <li>
      <a href="../articles/spatial-annotation-screening.html">Spatial Annotation Screening</a>
    </li>
    <li>
      <a href="../articles/creating-spatial-trajectories.html">Creating Spatial Trajectories</a>
    </li>
    <li>
      <a href="../articles/spatial-trajectory-screening.html">Spatial Trajectory Screening</a>
    </li>
    <li class="dropdown-header">Visualization</li>
    <li>
      <a href="../articles/plotting-surface.html">Surface Plotting</a>
    </li>
  </ul></li>
<li>
  <a href="../articles/newslog.html">Newslog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Clustering with BayesSpace</h1>

    <div class="hidden name"><code>runBayesSpaceClustering.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>A wrapper around the BayesSpace clustering pipeline introduced
by <em>Zhao et al. (2021)</em>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">runBayesSpaceClustering</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"bayes_space"</span>,</span>
<span>  n.Pcs <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  n.HVGs <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  skip.PCA <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  log.normalize <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  assay.type <span class="op">=</span> <span class="st">"logcounts"</span>,</span>
<span>  BSPARAM <span class="op">=</span> <span class="fu">BiocSingular</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocSingular/man/BiocSingularParam.html" class="external-link">ExactParam</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  qs <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">15</span>,</span>
<span>  burn.in <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1000</span><span class="op">)</span>,</span>
<span>  nrep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">50000</span><span class="op">)</span>,</span>
<span>  use.dimred <span class="op">=</span> <span class="st">"PCA"</span>,</span>
<span>  d <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  init.method <span class="op">=</span> <span class="st">"mclust"</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"t"</span>,</span>
<span>  gamma <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  mu0 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lambda0 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  beta <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  save.chain <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  chain.fname <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  prefix <span class="op">=</span> <span class="st">"B"</span>,</span>
<span>  return_model <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  empty_remove <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  assign_sce <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  assign_envir <span class="op">=</span> <span class="va">.GlobalEnv</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>An object of class <code><a href="SPATA2.html">SPATA2</a></code> or, in case of S4 generics,
objects of classes for which a method has been defined.</p></dd>


<dt id="arg-name">name<a class="anchor" aria-label="anchor" href="#arg-name"></a></dt>
<dd><p>Character value. The name the cluster variable has in
the feature data of the <code>SPATA2</code> object. Defaults to <em>bayes_space</em>.</p></dd>


<dt id="arg-n-hvgs">n.HVGs<a class="anchor" aria-label="anchor" href="#arg-n-hvgs"></a></dt>
<dd><p>Number of highly variable genes to run PCA upon.</p></dd>


<dt id="arg-skip-pca">skip.PCA<a class="anchor" aria-label="anchor" href="#arg-skip-pca"></a></dt>
<dd><p>Skip PCA (if dimensionality reduction was previously
computed.)</p></dd>


<dt id="arg-log-normalize">log.normalize<a class="anchor" aria-label="anchor" href="#arg-log-normalize"></a></dt>
<dd><p>Whether to log-normalize the input data with scater. May
be omitted if log-normalization previously computed.</p></dd>


<dt id="arg-assay-type">assay.type<a class="anchor" aria-label="anchor" href="#arg-assay-type"></a></dt>
<dd><p>Name of assay in <code>sce</code> containing normalized counts.
Leave as "logcounts" unless you explicitly pre-computed a different
normalization and added it to <code>sce</code> under another assay. Note that we
do not recommend running BayesSpace on PCs computed from raw counts.</p></dd>


<dt id="arg-bsparam">BSPARAM<a class="anchor" aria-label="anchor" href="#arg-bsparam"></a></dt>
<dd><p>A BiocSingularParam object specifying which
algorithm should be used to perform the PCA. By default, an exact PCA is
performed, as current spatial datasets are generally small (&lt;10,000 spots).
To perform a faster approximate PCA, please specify
<code>FastAutoParam()</code> and set a random seed to ensure
reproducibility.</p></dd>


<dt id="arg-qs">qs<a class="anchor" aria-label="anchor" href="#arg-qs"></a></dt>
<dd><p>The values of q to evaluate. If <code>qs</code> is only one value exactly
that is given to <code>q</code> of <code><a href="https://rdrr.io/pkg/BayesSpace/man/spatialCluster.html" class="external-link">BayesSpace::spatialCluster()</a></code>. Else the optimal
<code>q</code> from all provided values is identified using <code><a href="https://rdrr.io/pkg/BayesSpace/man/qTune.html" class="external-link">BayesSpace::qTune()</a></code>.</p></dd>


<dt id="arg-burn-in-nrep">burn.in, nrep<a class="anchor" aria-label="anchor" href="#arg-burn-in-nrep"></a></dt>
<dd><p>Integers specifying the range of repetitions to
compute.</p></dd>


<dt id="arg-use-dimred">use.dimred<a class="anchor" aria-label="anchor" href="#arg-use-dimred"></a></dt>
<dd><p>Name of a reduced dimensionality result in
<code>reducedDims(sce)</code>. If provided, cluster on these features directly.</p></dd>


<dt id="arg-d">d<a class="anchor" aria-label="anchor" href="#arg-d"></a></dt>
<dd><p>Number of top principal components to use when clustering.</p></dd>


<dt id="arg-init-method">init.method<a class="anchor" aria-label="anchor" href="#arg-init-method"></a></dt>
<dd><p>If <code>init</code> is not provided, cluster the top <code>d</code>
PCs with this method to obtain initial cluster assignments.</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>Error model. ('normal' or 't')</p></dd>


<dt id="arg-gamma">gamma<a class="anchor" aria-label="anchor" href="#arg-gamma"></a></dt>
<dd><p>Smoothing parameter. Defaults to 2 for <code>platform="ST"</code> and
3 for <code>platform="Visium"</code>. (Values in range of 1-3 seem to work well.)</p></dd>


<dt id="arg-mu-">mu0<a class="anchor" aria-label="anchor" href="#arg-mu-"></a></dt>
<dd><p>Prior mean hyperparameter for mu. If not provided, mu0 is set to
the mean of PCs over all spots.</p></dd>


<dt id="arg-lambda-">lambda0<a class="anchor" aria-label="anchor" href="#arg-lambda-"></a></dt>
<dd><p>Prior precision hyperparam for mu. If not provided, lambda0
is set to a diagonal matrix \(0.01 I\).</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>Hyperparameter for Wishart distributed precision lambda.</p></dd>


<dt id="arg-beta">beta<a class="anchor" aria-label="anchor" href="#arg-beta"></a></dt>
<dd><p>Hyperparameter for Wishart distributed precision lambda.</p></dd>


<dt id="arg-save-chain">save.chain<a class="anchor" aria-label="anchor" href="#arg-save-chain"></a></dt>
<dd><p>If true, save the MCMC chain to an HDF5 file.</p></dd>


<dt id="arg-chain-fname">chain.fname<a class="anchor" aria-label="anchor" href="#arg-chain-fname"></a></dt>
<dd><p>File path for saved chain. Tempfile used if not provided.</p></dd>


<dt id="arg-prefix">prefix<a class="anchor" aria-label="anchor" href="#arg-prefix"></a></dt>
<dd><p>Character value. Prefix of the cluster groups.</p></dd>


<dt id="arg-overwrite">overwrite<a class="anchor" aria-label="anchor" href="#arg-overwrite"></a></dt>
<dd><p>Logical value. If TRUE, <code>name</code> overwrites features
in feature data of the <code>SPATA2</code> object.</p></dd>


<dt id="arg-assign-sce">assign_sce<a class="anchor" aria-label="anchor" href="#arg-assign-sce"></a></dt>
<dd><p>Character value or <code>NULL</code>. If character, specifies the
name under which the bayes space output (object of class <code>SingleCellExperiment</code>)
is assigned to the global environment. This makes the whole output
of the bayes space pipeline available instead of only adding the clustering
output as a grouping variable to the <code>SPATA2</code> object.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, informative messages regarding
the computational progress will be printed.</p>
<p>(Warning messages will always be printed.)</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments given to <code><a href="https://rdrr.io/pkg/BayesSpace/man/spatialCluster.html" class="external-link">BayesSpace::spatialCluster()</a></code>. Exception:
<code>sce</code>, <code>q</code> are specified within the function.</p></dd>


<dt id="arg-q-force">q_force<a class="anchor" aria-label="anchor" href="#arg-q-force"></a></dt>
<dd><p>Numeric value or <code>FALSE</code>. If numeric, it forces the number
of output clusters with input value. If <code>FALSE</code>, the optimal number
of clusters is chosen for <code>q</code> determined by the elbow point of <code><a href="https://rdrr.io/pkg/BayesSpace/man/qTune.html" class="external-link">BayesSpace::qTune()</a></code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>The updated input object, containing the added, removed or computed results.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function is a wrapper around <code>readVisium()</code>,
<code>spatialPreprocess()</code>, <code>qTune()</code> and <code>spatialCluster()</code>
of the <code>BayesSpace</code> package. The results are stored in form of a grouping
variable in the feature data.frame of the returned <code>SPATA2</code> object.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Zhao E, Stone MR, Ren X, Guenthoer J, Smythe KS, Pulliam T,
Williams SR, Uytingco CR, Taylor SEB, Nghiem P, Bielas JH, Gottardo R.
Spatial transcriptomics at subspot resolution with BayesSpace.
Nat Biotechnol. 2021 Nov;39(11):1375-1384. doi: 10.1038/s41587-021-00935-2.
Epub 2021 Jun 3. PMID: 34083791; PMCID: PMC8763026.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="plotLoglik.html">plotLoglik()</a></code>, <code>find_elbow_point()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://themilolab.com/" class="external-link">SPATA2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"example_data"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">object</span> <span class="op">&lt;-</span> <span class="va">example_data</span><span class="op">$</span><span class="va">object_UKF313T_diet</span></span>
<span></span>
<span><span class="co"># tests options for q from 3 to 15 and picks the best</span></span>
<span><span class="va">object</span> <span class="op">&lt;-</span> <span class="fu">runBayesSpaceClustering</span><span class="op">(</span><span class="va">object</span>, name <span class="op">=</span> <span class="st">"new_bspace"</span>, qs <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="plotLoglik.html">plotLoglik</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run with q = 10 to force 10 clusters in the output</span></span>
<span><span class="va">object</span> <span class="op">&lt;-</span> <span class="fu">runBayesSpaceClustering</span><span class="op">(</span><span class="va">object</span>, name <span class="op">=</span> <span class="st">"bspace_10"</span>, qs <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span></code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Jan Kueckelhaus, Dieter-Henrik Heiland.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer></div>






  </body></html>

