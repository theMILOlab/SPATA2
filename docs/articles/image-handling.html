<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Image Handling • SPATA2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Image Handling">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SPATA2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/installation.html">Installation</a>
</li>
<li>
  <a href="../articles/spata-data.html">SPATAData</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Initiating a SPATA2 object</li>
    <li>
      <a href="../articles/initiation-and-preprocessing-customized.html">Initiation &amp; Preprocessing with individual data</a>
    </li>
    <li>
      <a href="../articles/initiation-and-preprocessing-merfish.html">Initiation &amp; Preprocessing with MERFISH data</a>
    </li>
    <li>
      <a href="../articles/initiation-and-preprocessing-visium.html">Initiation &amp; Preprocessing with Visium data</a>
    </li>
    <li>
      <a href="../articles/initiation-and-preprocessing-visium-hd.html">Initiation &amp; Preprocessing with VisiumHD data</a>
    </li>
    <li class="dropdown-header">Basic Manipulation of a SPATA2 object</li>
    <li>
      <a href="../articles/adding-data.html">Adding Data to SPATA2 objects</a>
    </li>
    <li>
      <a href="../articles/package-compatibility.html">Platform Compatibility</a>
    </li>
    <li>
      <a href="../articles/molecular-variables.html">Molecular Variables</a>
    </li>
    <li>
      <a href="../articles/image-handling.html">Image Handling</a>
    </li>
    <li>
      <a href="../articles/spatial-segmentation.html">Spatial Segmentation</a>
    </li>
    <li class="dropdown-header">Implemented Algorithms &amp; Concepts</li>
    <li>
      <a href="../articles/cnv.html">Copy Number Variations</a>
    </li>
    <li>
      <a href="../articles/clustering.html">Clustering</a>
    </li>
    <li>
      <a href="../articles/dimensional-reduction.html">Dimensional Reduction</a>
    </li>
    <li>
      <a href="../articles/dea.html">Differential Expression</a>
    </li>
    <li>
      <a href="../articles/gsea.html">Gene Set Enrichment</a>
    </li>
    <li>
      <a href="../articles/spatial-measures.html">Spatial Measures</a>
    </li>
    <li class="dropdown-header">Spatial Gradient Screening</li>
    <li>
      <a href="../articles/creating-spatial-annotations.html">Creating Spatial Annotations</a>
    </li>
    <li>
      <a href="../articles/using-spatial-annotations.html">Using Spatial Annotations</a>
    </li>
    <li>
      <a href="../articles/spatial-annotation-screening.html">Spatial Annotation Screening</a>
    </li>
    <li>
      <a href="../articles/creating-spatial-trajectories.html">Creating Spatial Trajectories</a>
    </li>
    <li>
      <a href="../articles/spatial-trajectory-screening.html">Spatial Trajectory Screening</a>
    </li>
    <li class="dropdown-header">Visualization</li>
    <li>
      <a href="../articles/plotting-surface.html">Surface Plotting</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/newslog.html">Newslog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Image Handling</h1>
            
      

      <div class="hidden name"><code>image-handling.Rmd</code></div>

    </div>

    
    
<div class="section level3">
<h3 id="introduction">1. Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>Spatial transcriptomic output often comes with a histology image.
SPATA2 offers many functions for histology specific analysis. Therefore,
detailed interaction between image dimensions and extent and data point
positions in form of data coordinates is required. This vignette
introduces the basic functions that ensure alignment between image and
data point coordinates and that allow to exchange low- and high
resolution image that come with any 10X Visium output. Furthermore, it
elaborates on how images are stored in SPATA2.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://themilolab.com/" class="external-link">SPATA2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SPATAData</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load SPATA2 inbuilt example data</span></span>
<span><span class="va">object_t275</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loadExampleObject.html">loadExampleObject</a></span><span class="op">(</span><span class="st">"UKF275T"</span><span class="op">)</span></span>
<span><span class="va">object_t275</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setDefault.html">setDefault</a></span><span class="op">(</span><span class="va">object_t275</span>, display_image <span class="op">=</span> <span class="cn">TRUE</span>, pt_size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="basic-image-handling">2. Basic image handling<a class="anchor" aria-label="anchor" href="#basic-image-handling"></a>
</h3>
<p>The following exemplifies how to use basic image related
functions.</p>
<div class="section level4">
<h4 id="extracting-image-data">2.1 Extracting image data<a class="anchor" aria-label="anchor" href="#extracting-image-data"></a>
</h4>
<p>To obtain the image, that is currently set as well as meta
information there exist several functions prefixed with
<code>getImage*()</code>. To name a few:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># the image </span></span>
<span><span class="fu"><a href="../reference/getImage.html">getImage</a></span><span class="op">(</span><span class="va">object_t275</span><span class="op">)</span></span>
<span><span class="co">## Image </span></span>
<span><span class="co">##   colorMode    : Color </span></span>
<span><span class="co">##   storage.mode : double </span></span>
<span><span class="co">##   dim          : 576 600 3 </span></span>
<span><span class="co">##   frames.total : 3 </span></span>
<span><span class="co">##   frames.render: 1 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## imageData(object)[1:5,1:6,1]</span></span>
<span><span class="co">##      [,1] [,2] [,3] [,4] [,5] [,6]</span></span>
<span><span class="co">## [1,]    1    1    1    1    1    1</span></span>
<span><span class="co">## [2,]    1    1    1    1    1    1</span></span>
<span><span class="co">## [3,]    1    1    1    1    1    1</span></span>
<span><span class="co">## [4,]    1    1    1    1    1    1</span></span>
<span><span class="co">## [5,]    1    1    1    1    1    1</span></span>
<span></span>
<span><span class="co"># image dimensions in width, height and colors</span></span>
<span><span class="fu"><a href="../reference/getImageDims.html">getImageDims</a></span><span class="op">(</span><span class="va">object_t275</span><span class="op">)</span></span>
<span><span class="co">## [1] 576 600   3</span></span>
<span></span>
<span><span class="co"># image range in terms of data coordinates</span></span>
<span><span class="fu"><a href="../reference/getImageDims.html">getImageRange</a></span><span class="op">(</span><span class="va">object_t275</span><span class="op">)</span></span>
<span><span class="co">## $x</span></span>
<span><span class="co">## [1]   1 576</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $y</span></span>
<span><span class="co">## [1]   1 600</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="plotting-images">2.2 Plotting images<a class="anchor" aria-label="anchor" href="#plotting-images"></a>
</h4>
<p>The function <code><a href="../reference/plotImage.html">plotImage()</a></code> visualizes the image. The
arguments <code>xrange</code> and <code>yrange</code> can be used to
zoom in on specific regions.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotImage.html">plotImage</a></span><span class="op">(</span><span class="va">object_t275</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/ggpLayerRect.html">ggpLayerRect</a></span><span class="op">(</span><span class="va">object_t275</span>, xrange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">400</span><span class="op">)</span>, yrange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">400</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotImage.html">plotImage</a></span><span class="op">(</span><span class="va">object_t275</span>, xrange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">400</span><span class="op">)</span>, yrange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">400</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="image-handling_files/figure-html/unnamed-chunk-3-1.png" width="50%"><img src="image-handling_files/figure-html/unnamed-chunk-3-2.png" width="50%">
As detailed below, SPATA2 allows to store multiple images. The names of
the images currently registered in the <code>SPATA2</code> object can be
obtained by <code><a href="../reference/getImageNames.html">getImageNames()</a></code>. They can be easily
renamed.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># right now, this object contains two registered images</span></span>
<span><span class="fu"><a href="../reference/getImageNames.html">getImageNames</a></span><span class="op">(</span><span class="va">object_t275</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "image1"       "very_low_res"</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getImageDims.html">getImageDims</a></span><span class="op">(</span><span class="va">object_t275</span>, img_name <span class="op">=</span> <span class="st">"image1"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 576 600   3</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># but image1 is quite an uninformative name - lets rename it</span></span>
<span><span class="va">object_t275</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/renameImage.html">renameImage</a></span><span class="op">(</span><span class="va">object_t275</span>, img_name <span class="op">=</span> <span class="st">"image1"</span>, new_img_name <span class="op">=</span> <span class="st">"normres"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/getImageNames.html">getImageNames</a></span><span class="op">(</span><span class="va">object_t275</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "normres"      "very_low_res"</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="registering-new-images">3. Registering new images<a class="anchor" aria-label="anchor" href="#registering-new-images"></a>
</h3>
<p>To integrate additional images in the workflow they must be
registered for the <code>SPATA2</code> object to know them. Registering
a new image means that a new container for the respective image is
created. (For more details on these containers read the documentation of
the classes <code>SpatialData</code> and <code>HistoImage</code>).</p>
<p>As a first example, we register the high resolution image which the
Visium platform always provides, usually named somewhat like
<em>spatial/tissue_hires_image.png</em>. If you have not already
registered the high resolution image with
<code><a href="../reference/initiateSpataObjectVisium.html">initiateSpataObjectVisium()</a></code> you can do that with
<code><a href="../reference/registerImage.html">registerImage()</a></code>. Lets register the high resolution image
which you can download <a href="">here</a>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">object_t275</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/registerImage.html">registerImage</a></span><span class="op">(</span></span>
<span>    object <span class="op">=</span> <span class="va">object_t275</span>, </span>
<span>    img_name <span class="op">=</span> <span class="st">"hires"</span>, <span class="co"># the future name of the image</span></span>
<span>    dir <span class="op">=</span> <span class="st">"data/UKF275T_tissue_hires_image.png"</span> <span class="co"># adjust to your directory</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># a third image has been registered</span></span>
<span><span class="fu"><a href="../reference/getImageNames.html">getImageNames</a></span><span class="op">(</span><span class="va">object_t275</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "normres"      "very_low_res" "hires"</span></span></code></pre>
<p>Generally speaking, registering an image means to set up the
container for the image and deposit a directory from where to read it.
We recommend to register images with their file directory, since storing
multiple images in the <code>SPATA2</code> object lets the object grow
in storage size quickly. This way, the file directory is used to load
the image everytime the image is required.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the hires image alone needs almost 100mb </span></span>
<span><span class="fu"><a href="../reference/getImage.html">getImage</a></span><span class="op">(</span><span class="va">object_t275</span>, img_name <span class="op">=</span> <span class="st">"hires"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">pryr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pryr/man/object_size.html" class="external-link">object_size</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 92.26 MB</span></span></code></pre>
<p>Note, that in the previous code chunk the argument
<code>img_name</code> was specified to obtain the image. In the code
chunk where we exemplified <code><a href="../reference/plotImage.html">plotImage()</a></code> the image name was
not specified. In that case the <code>SPATA2</code> object defaults to
the active image.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check which image is currently active</span></span>
<span><span class="fu"><a href="../reference/activateImage.html">activeImage</a></span><span class="op">(</span><span class="va">object_t275</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "normres"</span></span></code></pre>
<p>To change the active image use <code><a href="../reference/activateImage.html">activateImage()</a></code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">object_t275</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/activateImage.html">activateImage</a></span><span class="op">(</span><span class="va">object_t275</span>, img_name <span class="op">=</span> <span class="st">"hires"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># the default image to use has been switched to 'hires'</span></span>
<span><span class="fu"><a href="../reference/activateImage.html">activeImage</a></span><span class="op">(</span><span class="va">object_t275</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "hires"</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ... it is chosen by default </span></span>
<span><span class="fu"><a href="../reference/getImageDims.html">getImageDims</a></span><span class="op">(</span><span class="va">object_t275</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1922 2000    3</span></span></code></pre>
<p>By default, the <code>SPATA2</code> image <strong>loads</strong> the
active image, meaning that the image data actually exists in the object.
Therefore, the active image must not be read using the file directory
with which the image was registered. This accelerates image handling
with the image that is currently of interest, the active image. If you
have enough RAM, you can always load the image data of inactive images
using <code><a href="../reference/loadImage.html">loadImage()</a></code> to accelerate access to them when
referring to them within functions.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># before unloading</span></span>
<span><span class="fu">pryr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pryr/man/object_size.html" class="external-link">object_size</a></span><span class="op">(</span><span class="va">object_t275</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 157.22 MB</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># unload</span></span>
<span><span class="va">object_t275</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unloadImage.html">unloadImage</a></span><span class="op">(</span><span class="va">object_t275</span>, img_name <span class="op">=</span> <span class="st">"hires"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># after unloading</span></span>
<span><span class="fu">pryr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pryr/man/object_size.html" class="external-link">object_size</a></span><span class="op">(</span><span class="va">object_t275</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 64.97 MB</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># activate image normres again</span></span>
<span><span class="va">object_t275</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/activateImage.html">activateImage</a></span><span class="op">(</span><span class="va">object_t275</span>, img_name <span class="op">=</span> <span class="st">"normres"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># removing the image removes everything!</span></span>
<span><span class="va">object_t275</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/registerImage.html">removeImage</a></span><span class="op">(</span><span class="va">object_t275</span>, img_name <span class="op">=</span> <span class="st">"hires"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 'hires' is gone... </span></span>
<span><span class="fu"><a href="../reference/getImageNames.html">getImageNames</a></span><span class="op">(</span><span class="va">object_t275</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "normres"      "very_low_res"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="processing-images">4. Processing images<a class="anchor" aria-label="anchor" href="#processing-images"></a>
</h3>
<p><code>SPATA2</code> offers some image processing functions that allow
deeper interaction with the histological tissue slide. The function
<code><a href="../reference/identifyPixelContent.html">identifyPixelContent()</a></code> aims to identify the main tissue
slide(s), potential tissue fragments as well as artefacts.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># by default, the active image is chosen</span></span>
<span><span class="va">object_t275</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/identifyPixelContent.html">identifyPixelContent</a></span><span class="op">(</span><span class="va">object_t275</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotImage.html">plotImage</a></span><span class="op">(</span><span class="va">object_t275</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotImageMask.html">plotPixelContent</a></span><span class="op">(</span><span class="va">object_t275</span><span class="op">)</span></span></code></pre></div>
<p><img src="image-handling_files/figure-html/unnamed-chunk-11-1.png" width="50%"><img src="image-handling_files/figure-html/unnamed-chunk-11-2.png" width="50%"></p>
<p>The content can be used to identify the tissue outline based on the
image if <code>method = 'image'</code>. Note that
<code>method = 'obs'</code> identifies the tissue outline based on the
observations. The vignettes on how to initiate and process
<code>SPATA2</code> objects depending on the platform elaborate on this
option. Both outlines can be identified and stored simultaneously in the
<code>SPATA2</code> object.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">object_t275</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/identifyTissueOutline.html">identifyTissueOutline</a></span><span class="op">(</span><span class="va">object_t275</span>, method <span class="op">=</span> <span class="st">"image"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot the outline (if the tissue outline for an image has been identified)</span></span>
<span><span class="co"># uppper two plots</span></span>
<span><span class="fu"><a href="../reference/plotImages.html">plotImages</a></span><span class="op">(</span><span class="va">object_t275</span>, outline <span class="op">=</span> <span class="cn">TRUE</span>, line_size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># are all images aligned with the reference image? - yes they are! </span></span>
<span><span class="co"># lower two plots</span></span>
<span><span class="fu"><a href="../reference/plotImages.html">plotImages</a></span><span class="op">(</span><span class="va">object_t275</span>, outline_ref <span class="op">=</span> <span class="cn">TRUE</span>, line_color_ref <span class="op">=</span> <span class="st">"red"</span>, line_size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="image-handling_files/figure-html/unnamed-chunk-13-1.png" width="100%"><img src="image-handling_files/figure-html/unnamed-chunk-13-2.png" width="100%"></p>
<p>While the tissue outline based on histology can be used for spatial
outlier detection, too, it is particularly useful for image
alignment.</p>
</div>
<div class="section level3">
<h3 id="aligning-images">5. Aligning images<a class="anchor" aria-label="anchor" href="#aligning-images"></a>
</h3>
<p>If you want to integrate images from other sources, they might need
to be aligned with the spatial data of the <code>SPATA2</code> object.
Here, we must introduce the concept of the <em>reference image</em> with
which we refer to the image that is aligned with the observations of the
<code>SPATA2</code> object (here, barcoded spots). By default, it is the
first image you register or initiate the <code>SPATA2</code> object
with.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/refImage.html">refImage</a></span><span class="op">(</span><span class="va">object_t275</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "normres"</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/aoles/EBImage" class="external-link">EBImage</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># created an image with messed up alignment</span></span>
<span><span class="va">badly_aligned_img</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/getImage.html">getImage</a></span><span class="op">(</span><span class="va">object_t275</span>, img_name <span class="op">=</span> <span class="st">"normres"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/EBImage/man/spatial.html" class="external-link">translate</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">20</span><span class="op">)</span>, bg.col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># no directory specified, unloading wont be possible</span></span>
<span><span class="va">object_t275</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/registerImage.html">registerImage</a></span><span class="op">(</span></span>
<span>    object <span class="op">=</span> <span class="va">object_t275</span>, </span>
<span>    img <span class="op">=</span> <span class="va">badly_aligned_img</span>,</span>
<span>    img_name <span class="op">=</span> <span class="st">"badly_aligned"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotImages.html">plotImages</a></span><span class="op">(</span><span class="va">object_t275</span>, outline_ref <span class="op">=</span> <span class="cn">TRUE</span>, line_color_ref <span class="op">=</span> <span class="st">"black"</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="image-handling_files/figure-html/unnamed-chunk-15-1.png" width="100%"></p>
<p>Logically, this means that the added image is not aligned with the
data points of the <code>SPATA2</code> object which, in turn, means that
integration of molecular data and image features won’t work
reliably.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># left</span></span>
<span><span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object_t275</span>, img_name <span class="op">=</span> <span class="st">"normres"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># right</span></span>
<span><span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object_t275</span>, img_name <span class="op">=</span> <span class="st">"badly_aligned"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="image-handling_files/figure-html/unnamed-chunk-16-1.png" width="50%"><img src="image-handling_files/figure-html/unnamed-chunk-16-2.png" width="50%"></p>
<p>To ensure alignemnt of every single image registered in the
<code>SPATA2</code> object you can make use of two main functions
<code><a href="../reference/alignImage.html">alignImage()</a></code> or <code><a href="../reference/alignImage.html">alignImageInteractive()</a></code>. Both
do the following: They change the instructions with which the image is
transformed upon extraction whenever it is used. The function
<code><a href="../reference/alignImage.html">alignImage()</a></code> allows to specify the transformations required
to ensure alignment with the coordinates.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract the transformation instructions for an image</span></span>
<span><span class="co"># currently, the default: no transformation</span></span>
<span><span class="fu"><a href="../reference/getImageTransformations.html">getImageTransformations</a></span><span class="op">(</span><span class="va">object_t275</span>, img_name <span class="op">=</span> <span class="st">"badly_aligned"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $angle</span></span>
<span><span class="co">## [1] 0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $flip</span></span>
<span><span class="co">## $flip$horizontal</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $flip$vertical</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $stretch</span></span>
<span><span class="co">## $stretch$horizontal</span></span>
<span><span class="co">## [1] 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $stretch$vertical</span></span>
<span><span class="co">## [1] 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $translate</span></span>
<span><span class="co">## $translate$horizontal</span></span>
<span><span class="co">## [1] 0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $translate$vertical</span></span>
<span><span class="co">## [1] 0</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add the required transformation to align the image</span></span>
<span><span class="co"># see ?alignImage for documentation and more examples</span></span>
<span><span class="va">object_t275</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/alignImage.html">alignImage</a></span><span class="op">(</span></span>
<span>    object <span class="op">=</span> <span class="va">object_t275</span>, </span>
<span>    img_name <span class="op">=</span> <span class="st">"badly_aligned"</span>, </span>
<span>    opt <span class="op">=</span> <span class="st">"set"</span>, <span class="co"># 'set' is the default, 'add' is also possible </span></span>
<span>    transl_h <span class="op">=</span> <span class="op">-</span><span class="fl">25</span>, </span>
<span>    transl_v <span class="op">=</span> <span class="op">-</span><span class="fl">20</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># instructions have changed...</span></span>
<span><span class="fu"><a href="../reference/getImageTransformations.html">getImageTransformations</a></span><span class="op">(</span><span class="va">object_t275</span>, img_name <span class="op">=</span> <span class="st">"badly_aligned"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $angle</span></span>
<span><span class="co">## [1] 0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $flip</span></span>
<span><span class="co">## $flip$horizontal</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $flip$vertical</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $stretch</span></span>
<span><span class="co">## $stretch$horizontal</span></span>
<span><span class="co">## [1] 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $stretch$vertical</span></span>
<span><span class="co">## [1] 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $translate</span></span>
<span><span class="co">## $translate$horizontal</span></span>
<span><span class="co">## [1] -25</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $translate$vertical</span></span>
<span><span class="co">## [1] -20</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ... and are applied whenever the image is used if transform = TRUE (default)</span></span>
<span><span class="co"># upper three plots</span></span>
<span><span class="fu"><a href="../reference/plotImages.html">plotImages</a></span><span class="op">(</span><span class="va">object_t275</span>, outline_ref <span class="op">=</span> <span class="cn">TRUE</span>, transform <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"transform = TRUE"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># lower three plots</span></span>
<span><span class="fu"><a href="../reference/plotImages.html">plotImages</a></span><span class="op">(</span><span class="va">object_t275</span>, outline_ref <span class="op">=</span> <span class="cn">TRUE</span>, transform <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"transform = FALSE"</span><span class="op">)</span></span></code></pre></div>
<p><img src="image-handling_files/figure-html/unnamed-chunk-17-1.png" width="100%"><img src="image-handling_files/figure-html/unnamed-chunk-17-2.png" width="100%"></p>
<p>In real life scenarios the exact transformations required are unknown
and trying around over and over again manually with
<code><a href="../reference/alignImage.html">alignImage()</a></code> and <code><a href="../reference/plotSurface.html">plotSurface()</a></code> is cumbersome.
The function <code><a href="../reference/alignImage.html">alignImageInteractive()</a></code> gives access to an
interface where you can align a badly aligned image with the outline of
the reference image.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># reset transformations to make the image "badly aligned" again</span></span>
<span><span class="va">object_t275</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/resetImageTransformations.html">resetImageTransformations</a></span><span class="op">(</span><span class="va">object_t275</span>, img_name <span class="op">=</span> <span class="st">"badly_aligned"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">object_t275</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/alignImage.html">alignImageInteractive</a></span><span class="op">(</span><span class="va">object_t275</span><span class="op">)</span></span></code></pre></div>
<p><img src="gifs/align_image_interactive.gif" width="100%"></p>
<p>As with <code>alignImaage()</code>, the results of the interactive
alignment are stored in the <code>SPATA2</code> object.</p>
</div>
<div class="section level2">
<h2 id="storing-images">6. Storing images<a class="anchor" aria-label="anchor" href="#storing-images"></a>
</h2>
<p>In a <code>SPATA2</code> object, images are not loosely stored.
Actually, every image gets an image-container upon registration. This
image-container is an S4 class named <code>HistoImage</code>. This
objects contain not only the image but information around the image,
such as pixel content, tissue outline, dimensions, file directories
etc.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract the image</span></span>
<span><span class="va">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getImage.html">getImage</a></span><span class="op">(</span><span class="va">object_t275</span>, img_name <span class="op">=</span> <span class="st">"badly_aligned"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Image"</span></span>
<span><span class="co">## attr(,"package")</span></span>
<span><span class="co">## [1] "EBImage"</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extrac the image container</span></span>
<span><span class="va">hist_img</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getHistoImage.html">getHistoImage</a></span><span class="op">(</span><span class="va">object_t275</span>, img_name <span class="op">=</span> <span class="st">"badly_aligned"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># hist_img is an S4 object of class `HistoImage`</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">hist_img</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "HistoImage"</span></span>
<span><span class="co">## attr(,"package")</span></span>
<span><span class="co">## [1] "SPATA2"</span></span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ... it contains the image as obtained by `getImage()`</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">hist_img</span><span class="op">@</span><span class="va">image</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Image"</span></span>
<span><span class="co">## attr(,"package")</span></span>
<span><span class="co">## [1] "EBImage"</span></span></code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">hist_img</span><span class="op">@</span><span class="va">image</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 576 600   3</span></span></code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># all slot names of the container</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/methods/slot.html" class="external-link">slotNames</a></span><span class="op">(</span><span class="va">hist_img</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "active"          "aligned"         "bg_color"        "dir"            </span></span>
<span><span class="co">##  [5] "image"           "image_info"      "name"            "outline"        </span></span>
<span><span class="co">##  [9] "overlap"         "pixel_content"   "reference"       "sample"         </span></span>
<span><span class="co">## [13] "scale_factors"   "transformations"</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jan Kueckelhaus, Dieter-Henrik Heiland.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
