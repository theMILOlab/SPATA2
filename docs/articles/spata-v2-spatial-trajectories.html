<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spatial Trajectories • SPATA2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Spatial Trajectories">
<meta property="og:description" content="SPATA2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SPATA2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/spata-v2-installation.html">Installation</a>
</li>
<li>
  <a href="../articles/spata-v2-spata-data.html">SPATAData</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Around the spata2 object</li>
    <li>
      <a href="../articles/spata-v2-object-initiation-and-manipulation.html">Object Set Up and Manipulation</a>
    </li>
    <li>
      <a href="../articles/spata-v2-platform-compatibility.html">Platform Compatibility</a>
    </li>
    <li>
      <a href="../articles/spata-v2-autoencoder.html">Autoencoder</a>
    </li>
    <li>
      <a href="../articles/spata-v2-genes-gene-sets-and-features.html">Genes, Gene Sets and Features</a>
    </li>
    <li class="dropdown-header">Image Analysis</li>
    <li>
      <a href="../articles/spata-v2-image-handling.html">Image Handling</a>
    </li>
    <li>
      <a href="../articles/spata-v2-image-annotations.html">Image Annotations</a>
    </li>
    <li>
      <a href="../articles/spata-v2-spatial-segmentation.html">Spatial Segmentation</a>
    </li>
    <li class="dropdown-header">Analysis of Gene Expression</li>
    <li>
      <a href="../articles/spata-v2-cnv-analysis.html">Copy Number Variations</a>
    </li>
    <li>
      <a href="../articles/spata-v2-clustering.html">Clustering</a>
    </li>
    <li>
      <a href="../articles/spata-v2-dea.html">Differential Expression</a>
    </li>
    <li>
      <a href="../articles/spata-v2-gsea.html">Gene Set Enrichment</a>
    </li>
    <li class="dropdown-header">Expression Gradients &amp; Gradient Screening</li>
    <li>
      <a href="../articles/spata-v2-spatial-trajectories.html">Spatial Trajectories</a>
    </li>
    <li>
      <a href="../articles/spata-v2-spatial-trajectory-screening.html">Spatial Trajectory Screening</a>
    </li>
    <li>
      <a href="../articles/spata-v2-image-annotation-screening.html">Image Annotation Screening</a>
    </li>
    <li>
      <a href="../articles/spata-v2-scd.html">Integrate Single Cell Deconvolution</a>
    </li>
    <li class="dropdown-header">Visualization</li>
    <li>
      <a href="../articles/spata-v2-plotting-surface.html">Surface Plotting</a>
    </li>
    <li>
      <a href="../articles/spata-v2-plotting-misc.html">Miscellaneous</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Code &amp; Concept
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cc-spatial-measures.html">Spatial Measures</a>
    </li>
    <li>
      <a href="../articles/cc-spatial-segmentation-vs-image-annotations.html">Spatial Segmentation vs. Image Annotations</a>
    </li>
    <li>
      <a href="../articles/cc-spatial-trajectory-screening.html">Spatial Trajectory Screening</a>
    </li>
    <li>
      <a href="../articles/cc-image-annotation-screening.html">Image Annotation Screening</a>
    </li>
    <li>
      <a href="../articles/cc-model-fitting-in-spatial-transcriptomic-studies.html">Model Fitting</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Spatial Trajectories</h1>
            
      
      
      <div class="hidden name"><code>spata-v2-spatial-trajectories.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="prerequisites">1. Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<p>None.</p>
</div>
<div class="section level2">
<h2 id="introduction-overview">2. Introduction &amp; overview<a class="anchor" aria-label="anchor" href="#introduction-overview"></a>
</h2>
<p>With spatial trajectory analysis <code>SPATA2</code> introduces a new
approach to find, analyze and visualize differently expressed genes and
gene-sets in a spatial context. While the classic differential gene
expression analyzes differences between experimental groups as a whole
it neglects changes of expression levels that can only be seen while
maintaining the spatial dimensions. Spatial trajectories allow to answer
questions that include such a spatial component. E.g.:</p>
<ol style="list-style-type: decimal">
<li>In how far do expression levels change the more we move towards a
region of interest?</li>
<li>Which genes follow the same pattern along these paths?</li>
</ol>
<p>The spatial trajectory tools provided in <code>SPATA2</code> enable
new ways of visualization as well as new possibilities to screen for
genes.</p>
<p>As an example we are using a spatial transcriptomic sample of a
central nervous system malignancy that features three different,
adjacent histological areas: Tumor, a transition zone as well as
infiltrated cortex.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://themilolab.com/" class="external-link">SPATA2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SPATAData</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span>

<span class="va">object_t269</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/downloadSpataObject.html">downloadSpataObject</a></span><span class="op">(</span>sample_name <span class="op">=</span> <span class="st">"269_T"</span><span class="op">)</span>

<span class="co"># load example image annotations</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"image_annotations"</span><span class="op">)</span>

<span class="va">object_t269</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/setImageAnnotation.html">setImageAnnotations</a></span><span class="op">(</span>
    object <span class="op">=</span> <span class="va">object_t269</span>, 
    img_anns <span class="op">=</span> <span class="va">image_annotations</span><span class="op">[[</span><span class="st">"269_T"</span><span class="op">]</span><span class="op">]</span>,
    overwrite <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>

<span class="co"># plot results</span>
<span class="fu"><a href="../reference/plotImageGgplot.html">plotImageGgplot</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object_t269</span>, frame_by <span class="op">=</span> <span class="st">"coords"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="../reference/ggpLayerThemeCoords.html">ggpLayerThemeCoords</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="../reference/plotImageAnnotations.html">plotImageAnnotations</a></span><span class="op">(</span>
  object <span class="op">=</span> <span class="va">object_t269</span>,
  tags <span class="op">=</span> <span class="st">"hist_example"</span>, 
  square <span class="op">=</span> <span class="cn">TRUE</span>,
  expand <span class="op">=</span> <span class="fl">0.5</span>, 
  encircle <span class="op">=</span> <span class="cn">FALSE</span>, 
  nrow <span class="op">=</span> <span class="fl">2</span>, 
  display_caption <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span></code></pre></div>
<div class="figure">
<img src="spata-v2-spatial-trajectories_files/figure-html/unnamed-chunk-2-1.png" alt="Fig.1 Example sample T269." width="50%"><img src="spata-v2-spatial-trajectories_files/figure-html/unnamed-chunk-2-2.png" alt="Fig.1 Example sample T269." width="50%"><p class="caption">
Fig.1 Example sample T269.
</p>
</div>
</div>
<div class="section level2">
<h2 id="set-up-spatial-trajectories">3. Set up spatial trajectories<a class="anchor" aria-label="anchor" href="#set-up-spatial-trajectories"></a>
</h2>
<p>Spatial trajectories can be added to the <code>spata2</code> object
via two functions, namely <code>createSpatialTrajectory()</code> and
<code><a href="../reference/createSpatialTrajectories.html">addSpatialTrajectory()</a></code>.</p>
<div class="section level3">
<h3 id="interactive-drawing">3.1 Interactive drawing<a class="anchor" aria-label="anchor" href="#interactive-drawing"></a>
</h3>
<p>Fig.2 shows the interface of
<code><a href="../reference/createSpatialTrajectories.html">createSpatialTrajectories()</a></code>. To draw a trajectory double
click on the surface plot to mark the trajectory’s starting point and
then double click again to mark the endpoint. The result should look
somewhat like the trajectory drawn in Fig.2.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">object_t269</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createSpatialTrajectories.html">createSpatialTrajectories</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object_t269</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="images/create_spat_trajectories_interface_traj.JPG" alt="Fig.2 Interface of createSpatialTrajectories() with a drawn trajectory." width="100%"><p class="caption">
Fig.2 Interface of createSpatialTrajectories() with a drawn trajectory.
</p>
</div>
<p>If you are satisfied with the course of the trajectory determine the
width of the trajectory’s scope <strong>on the left</strong> and click
on highlight. Then enter a valid ID with which you want to name the
trajectory and click on ‘Save Trajectory’.</p>
<div class="figure">
<img src="images/create_spat_trajectories_highlighted.JPG" alt="Fig.3 Adjust trajectory width, higlight the spots and enter a name." width="100%"><p class="caption">
Fig.3 Adjust trajectory width, higlight the spots and enter a name.
</p>
</div>
<p>The trajectory should appear on the right side of the interface under
‘Trajectory IDs:’. Click on the name and click on ‘UPDATE PLOT’ to
visualize the trajectory with the barcode-spots it includes on the
histology image.</p>
</div>
<div class="section level3">
<h3 id="with-code">3.2 With code<a class="anchor" aria-label="anchor" href="#with-code"></a>
</h3>
<p>Instead of drawing the spatial trajectory you can add it directly by
explicitly naming its course via start- and endpoint using the function
<code><a href="../reference/createSpatialTrajectories.html">addSpatialTrajectory()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">object_t269</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/createSpatialTrajectories.html">addSpatialTrajectory</a></span><span class="op">(</span>
    object <span class="op">=</span> <span class="va">object_t269</span>,
    id <span class="op">=</span> <span class="st">"horizontal_mid"</span>,
    start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1.5mm"</span>, <span class="st">"3.5mm"</span><span class="op">)</span> ,
    end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"6.5mm"</span>, <span class="st">"3.5mm"</span><span class="op">)</span> ,
    width <span class="op">=</span> <span class="st">"2mm"</span>,
    overwrite <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="extract-trajectory-information">4. Extract trajectory information<a class="anchor" aria-label="anchor" href="#extract-trajectory-information"></a>
</h2>
<p>Spatial trajectories are stored in form of S4 objects of class
<code>SpatialTrajectory</code>. The can be extracted via
<code><a href="../reference/getSpatialTrajectory.html">getSpatialTrajectory()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">traj_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getSpatialTrajectoryIds.html">getSpatialTrajectoryIds</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object_t269</span><span class="op">)</span>

<span class="va">traj_ids</span></code></pre></div>
<pre><code><span class="co">## [1] "horizontal_mid"</span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">traj_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getSpatialTrajectory.html">getSpatialTrajectory</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object_t269</span>, id <span class="op">=</span> <span class="st">"horizontal_mid"</span><span class="op">)</span>

<span class="va">traj_obj</span></code></pre></div>
<pre><code><span class="co">## An object of class "SpatialTrajectory"</span>
<span class="co">## Slot "coords":</span>
<span class="co">## <span style="color: #949494;"># A tibble: 3,213 x 6</span></span>
<span class="co">##    barcodes           sample     x     y section outline</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> AAACAAGTATCTCCCA-1 269_T  <span style="text-decoration: underline;">1</span>450.  731. 1       FALSE  </span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> AAACACCAATAACTGC-1 269_T   411.  547. 1       FALSE  </span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> AAACAGAGCGACTCCT-1 269_T  <span style="text-decoration: underline;">1</span>359. <span style="text-decoration: underline;">1</span>516  1       FALSE  </span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> AAACATTTCCCGGATT-1 269_T  <span style="text-decoration: underline;">1</span>386.  493. 1       FALSE  </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> AAACCCGAACGAAATC-1 269_T  <span style="text-decoration: underline;">1</span>614.  838. 1       FALSE  </span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> AAACCGGGTAGGTACC-1 269_T   527.  916. 1       FALSE  </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> AAACCGTTCGTCCAGG-1 269_T   700.  696  1       FALSE  </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> AAACCTAAGCAGCCGG-1 269_T  <span style="text-decoration: underline;">1</span>210.  408. 1       FALSE  </span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> AAACCTCATGAAGTTG-1 269_T   416. <span style="text-decoration: underline;">1</span>026. 1       FALSE  </span>
<span class="co">## <span style="color: #BCBCBC;">10</span> AAACGAGACGGTTGAT-1 269_T  <span style="text-decoration: underline;">1</span>167. <span style="text-decoration: underline;">1</span>061. 1       FALSE  </span>
<span class="co">## <span style="color: #949494;"># i 3,203 more rows</span></span>
<span class="co">## </span>
<span class="co">## Slot "info":</span>
<span class="co">## $current_dim</span>
<span class="co">## [1] 1939 2000    3</span>
<span class="co">## </span>
<span class="co">## $current_just</span>
<span class="co">## $current_just$angle</span>
<span class="co">## [1] 0</span>
<span class="co">## </span>
<span class="co">## $current_just$flipped</span>
<span class="co">## $current_just$flipped$horizontal</span>
<span class="co">## [1] FALSE</span>
<span class="co">## </span>
<span class="co">## $current_just$flipped$vertical</span>
<span class="co">## [1] FALSE</span>
<span class="co">## </span>
<span class="co">## </span>
<span class="co">## </span>
<span class="co">## </span>
<span class="co">## Slot "width_unit":</span>
<span class="co">## [1] "mm"</span>
<span class="co">## </span>
<span class="co">## Slot "comment":</span>
<span class="co">## [1] ""</span>
<span class="co">## </span>
<span class="co">## Slot "id":</span>
<span class="co">## [1] "horizontal_mid"</span>
<span class="co">## </span>
<span class="co">## Slot "projection":</span>
<span class="co">## <span style="color: #949494;"># A tibble: 2,301 x 6</span></span>
<span class="co">##    barcodes           sample     x     y projection_length trajectory_part</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> GCAACACACTAGAACT-1 269_T   377.  830             0.039<span style="text-decoration: underline;">7</span> Part 1         </span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> TCAACATCGACCGAGA-1 269_T   377.  874.            0.439  Part 1         </span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> TGCAGCTACGTACTTC-1 269_T   377.  917.            0.839  Part 1         </span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> TTCAGGCGTCAAAGCC-1 269_T   378.  961.            1.24   Part 1         </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> GGGCCCTACGAAAGGG-1 269_T   378. <span style="text-decoration: underline;">1</span>004             1.64   Part 1         </span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> TACTCGGCACGCCGGG-1 269_T   379. <span style="text-decoration: underline;">1</span>048.            2.44   Part 1         </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> TTACTATCGGCTTCTC-1 269_T   379. <span style="text-decoration: underline;">1</span>091.            2.84   Part 1         </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> CTGATAGTGTATCTCA-1 269_T   380. <span style="text-decoration: underline;">1</span>135.            3.24   Part 1         </span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> AATGGTCCACCGTTCA-1 269_T   380. <span style="text-decoration: underline;">1</span>178.            3.64   Part 1         </span>
<span class="co">## <span style="color: #BCBCBC;">10</span> TAACAATATTTGTTGC-1 269_T   381. <span style="text-decoration: underline;">1</span>222.            4.04   Part 1         </span>
<span class="co">## <span style="color: #949494;"># i 2,291 more rows</span></span>
<span class="co">## </span>
<span class="co">## Slot "sample":</span>
<span class="co">## [1] "269_T"</span>
<span class="co">## </span>
<span class="co">## Slot "segment":</span>
<span class="co">##          x        y     xend     yend   part</span>
<span class="co">## 1 376.5661 878.6542 1631.786 878.6542 part_1</span>
<span class="co">## </span>
<span class="co">## Slot "width":</span>
<span class="co">## [1] 502.0881</span></code></pre>
<p>For more information on the S4 class use
<code><a href="../reference/SpatialTrajectory-class.html">?SpatialTrajectory</a></code>.</p>
</div>
<div class="section level2">
<h2 id="visualization-with-spatial-trajectories">5. Visualization with spatial trajectories<a class="anchor" aria-label="anchor" href="#visualization-with-spatial-trajectories"></a>
</h2>
<p>Spatial trajectories indicate a direction, in case of
<em>horizontal_mid</em> it indicates the direction from left to right or
from tumor to infiltrated cortex. This can be used to infer and
visualize gene expression changes in space.</p>
<div class="section level3">
<h3 id="numeric-variables">5.1 Numeric variables<a class="anchor" aria-label="anchor" href="#numeric-variables"></a>
</h3>
<p>The four genes <em>EGFR</em>, <em>MBP</em>, <em>SNAP25</em> and
<em>BCL9</em> serve as an example. They first three are marker genes
detected by <a href="spata-v2-dea.html">DEA</a> based on the
histological grouping.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EGFR"</span>, <span class="st">"MBP"</span>, <span class="st">"SNAP25"</span>, <span class="st">"BCL9"</span><span class="op">)</span>

<span class="va">gene_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/color_vector.html">color_vector</a></span><span class="op">(</span>clrp <span class="op">=</span> <span class="st">"npg"</span>, names <span class="op">=</span> <span class="va">genes</span><span class="op">)</span>

<span class="va">gene_colors</span></code></pre></div>
<pre><code><span class="co">##        EGFR         MBP      SNAP25        BCL9 </span>
<span class="co">## "#E64B35FF" "#4DBBD5FF" "#00A087FF" "#3C5488FF"</span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trajectory</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/ggpLayerTrajectories.html">ggpLayerTrajectories</a></span><span class="op">(</span>
    object <span class="op">=</span> <span class="va">object_t269</span>, 
    ids <span class="op">=</span> <span class="st">"horizontal_mid"</span>,
    size <span class="op">=</span> <span class="fl">1</span>
    <span class="op">)</span>

<span class="va">tissue_outline</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggpLayerTissueOutline.html">ggpLayerTissueOutline</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object_t269</span><span class="op">)</span>

<span class="va">plist</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/imap.html" class="external-link">imap</a></span><span class="op">(</span>
    .x <span class="op">=</span> <span class="va">gene_colors</span>, 
    .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">color</span>, <span class="va">gene</span><span class="op">)</span><span class="op">{</span>
      
      <span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span><span class="va">object_t269</span>, color_by <span class="op">=</span> <span class="va">gene</span>, display_image <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span> 
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="fl">0</span><span class="op">)</span>, high <span class="op">=</span> <span class="va">color</span><span class="op">)</span> <span class="op">+</span> 
        <span class="va">tissue_outline</span> <span class="op">+</span> 
        <span class="va">trajectory</span>
      
    <span class="op">}</span><span class="op">)</span>

<span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span><span class="va">plist</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="spata-v2-spatial-trajectories_files/figure-html/unnamed-chunk-8-1.png" alt="Fig.4 Surface plots with trajectory course." width="100%"><p class="caption">
Fig.4 Surface plots with trajectory course.
</p>
</div>
<p>The inferred expression changes along the trajectory can be plotted
via line plots…</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotTrajectoryLineplot.html">plotTrajectoryLineplot</a></span><span class="op">(</span>
  object <span class="op">=</span> <span class="va">object_t269</span>, 
  id <span class="op">=</span> <span class="st">"horizontal_mid"</span>,
  variables <span class="op">=</span> <span class="va">genes</span>, 
  smooth_se <span class="op">=</span> <span class="cn">TRUE</span>, 
  clrp_adjust <span class="op">=</span> <span class="va">gene_colors</span>
<span class="op">)</span> </code></pre></div>
<div class="figure">
<img src="spata-v2-spatial-trajectories_files/figure-html/unnamed-chunk-9-1.png" alt="Fig.5 Inferred gene expression along the trajectory with line plots." width="100%"><p class="caption">
Fig.5 Inferred gene expression along the trajectory with line plots.
</p>
</div>
<p>… or ridgeplots.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotTrajectoryLineplot.html">plotTrajectoryRidgeplot</a></span><span class="op">(</span>
  object <span class="op">=</span> <span class="va">object_t269</span>,
  id <span class="op">=</span> <span class="st">"horizontal_mid"</span>,
  variables <span class="op">=</span> <span class="va">genes</span>, 
  clrp_adjust <span class="op">=</span> <span class="va">gene_colors</span>
<span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/legendBottom.html">legendNone</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="spata-v2-spatial-trajectories_files/figure-html/unnamed-chunk-10-1.png" alt="Fig.6 Inferred gene expression along trajectory with ridgeplots." width="100%"><p class="caption">
Fig.6 Inferred gene expression along trajectory with ridgeplots.
</p>
</div>
</div>
<div class="section level3">
<h3 id="grouping-variables">5.2 Grouping variables<a class="anchor" aria-label="anchor" href="#grouping-variables"></a>
</h3>
<p>The changes of grouping variables along the trajectory can not be
displayed with line plots but with bar plots</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load example list</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"spatial_segmentations"</span><span class="op">)</span>

<span class="va">object_t269</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/addFeatures.html">addFeatures</a></span><span class="op">(</span>
    object <span class="op">=</span> <span class="va">object_t269</span>,
    feature_df <span class="op">=</span> <span class="va">spatial_segmentations</span><span class="op">[[</span><span class="st">"269_T"</span><span class="op">]</span><span class="op">]</span>,
    overwrite <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>

<span class="co"># surface</span>
<span class="va">hist_plot_surface</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span>
    object <span class="op">=</span> <span class="va">object_t269</span>,
    color_by <span class="op">=</span> <span class="st">"histology"</span>,
    pt_clrp <span class="op">=</span> <span class="st">"npg"</span>
    <span class="op">)</span>

<span class="va">seurat_plot_surface</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span>
    object <span class="op">=</span> <span class="va">object_t269</span>,
    color_by <span class="op">=</span> <span class="st">"seurat_clusters"</span>,
    pt_clrp <span class="op">=</span> <span class="st">"lo"</span>
  <span class="op">)</span>

<span class="co"># bar plots</span>
<span class="va">hist_barplot</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/plotTrajectoryBarplot.html">plotTrajectoryBarplot</a></span><span class="op">(</span>
    object <span class="op">=</span> <span class="va">object_t269</span>,
    id <span class="op">=</span> <span class="st">"horizontal_mid"</span>,
    grouping_variable <span class="op">=</span> <span class="st">"histology"</span>,
    clrp <span class="op">=</span> <span class="st">"npg"</span>
  <span class="op">)</span>

<span class="va">seurat_barplot</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/plotTrajectoryBarplot.html">plotTrajectoryBarplot</a></span><span class="op">(</span>
    object <span class="op">=</span> <span class="va">object_t269</span>,
    id <span class="op">=</span> <span class="st">"horizontal_mid"</span>,
    grouping_variable <span class="op">=</span> <span class="st">"seurat_clusters"</span>,
    clrp <span class="op">=</span> <span class="st">"lo"</span>
  <span class="op">)</span>

<span class="co"># plot results</span>
<span class="va">hist_plot_surface</span> <span class="op">+</span> <span class="va">trajectory</span>

<span class="va">hist_barplot</span>

<span class="va">seurat_plot_surface</span> <span class="op">+</span> <span class="va">trajectory</span> 

<span class="va">seurat_barplot</span></code></pre></div>
<div class="figure">
<img src="spata-v2-spatial-trajectories_files/figure-html/unnamed-chunk-11-1.png" alt="Fig.7 Visualizing grouping variables." width="50%"><img src="spata-v2-spatial-trajectories_files/figure-html/unnamed-chunk-11-2.png" alt="Fig.7 Visualizing grouping variables." width="50%"><img src="spata-v2-spatial-trajectories_files/figure-html/unnamed-chunk-11-3.png" alt="Fig.7 Visualizing grouping variables." width="50%"><img src="spata-v2-spatial-trajectories_files/figure-html/unnamed-chunk-11-4.png" alt="Fig.7 Visualizing grouping variables." width="50%"><p class="caption">
Fig.7 Visualizing grouping variables.
</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jan Kueckelhaus, Dieter-Henrik Heiland, Simon Frerich.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
