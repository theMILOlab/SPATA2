<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Image Annotations • SPATA2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Image Annotations">
<meta property="og:description" content="SPATA2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SPATA2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/spata-v2-installation.html">Installation</a>
</li>
<li>
  <a href="../articles/spata-v2-spata-data.html">SPATAData</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Around the spata2 object</li>
    <li>
      <a href="../articles/spata-v2-object-initiation-and-manipulation.html">Object Set Up and Manipulation</a>
    </li>
    <li>
      <a href="../articles/spata-v2-platform-compatibility.html">Platform Compatibility</a>
    </li>
    <li>
      <a href="../articles/spata-v2-autoencoder.html">Autoencoder</a>
    </li>
    <li>
      <a href="../articles/spata-v2-genes-gene-sets-and-features.html">Genes, Gene Sets and Features</a>
    </li>
    <li class="dropdown-header">Image Analysis</li>
    <li>
      <a href="../articles/spata-v2-image-handling.html">Image Handling</a>
    </li>
    <li>
      <a href="../articles/spata-v2-image-annotations.html">Image Annotations</a>
    </li>
    <li>
      <a href="../articles/spata-v2-spatial-segmentation.html">Spatial Segmentation</a>
    </li>
    <li class="dropdown-header">Analysis of Gene Expression</li>
    <li>
      <a href="../articles/spata-v2-cnv-analysis.html">Copy Number Variations</a>
    </li>
    <li>
      <a href="../articles/spata-v2-clustering.html">Clustering</a>
    </li>
    <li>
      <a href="../articles/spata-v2-dea.html">Differential Expression</a>
    </li>
    <li>
      <a href="../articles/spata-v2-gsea.html">Gene Set Enrichment</a>
    </li>
    <li class="dropdown-header">Expression Gradients &amp; Gradient Screening</li>
    <li>
      <a href="../articles/spata-v2-spatial-trajectories.html">Spatial Trajectories</a>
    </li>
    <li>
      <a href="../articles/spata-v2-spatial-trajectory-screening.html">Spatial Trajectory Screening</a>
    </li>
    <li>
      <a href="../articles/spata-v2-image-annotation-screening.html">Image Annotation Screening</a>
    </li>
    <li>
      <a href="../articles/spata-v2-scd.html">Integrate Single Cell Deconvolution</a>
    </li>
    <li class="dropdown-header">Visualization</li>
    <li>
      <a href="../articles/spata-v2-plotting-surface.html">Surface Plotting</a>
    </li>
    <li>
      <a href="../articles/spata-v2-plotting-misc.html">Miscellaneous</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Code &amp; Concept
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cc-spatial-measures.html">Spatial Measures</a>
    </li>
    <li>
      <a href="../articles/cc-spatial-segmentation-vs-image-annotations.html">Spatial Segmentation vs. Image Annotations</a>
    </li>
    <li>
      <a href="../articles/cc-spatial-trajectory-screening.html">Spatial Trajectory Screening</a>
    </li>
    <li>
      <a href="../articles/cc-image-annotation-screening.html">Image Annotation Screening</a>
    </li>
    <li>
      <a href="../articles/cc-model-fitting-in-spatial-transcriptomic-studies.html">Model Fitting</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Image Annotations</h1>
            
      
      
      <div class="hidden name"><code>spata-v2-image-annotations.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="prerequisites">1. Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<p>Please make sure to be familiar with the following vignettes before
reading this tutorial.</p>
<ul>
<li><a href="cc-spatial-segementation-vs-image-annotations.html">Spatial
Segmentation vs. Image Annotations</a></li>
</ul>
</div>
<div class="section level2">
<h2 id="introduction-overview">2. Introduction &amp; overview<a class="anchor" aria-label="anchor" href="#introduction-overview"></a>
</h2>
<p>This tutorial describes how to use SPATA to integrate the histology
of your sample into your analysis.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://themilolab.com/" class="external-link">SPATA2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SPATAData</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>

<span class="va">object_t313</span> <span class="op">&lt;-</span> <span class="fu">SPATAData</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SPATAData/man/downloadSpataObject.html" class="external-link">downloadSpataObject</a></span><span class="op">(</span>sample_name <span class="op">=</span> <span class="st">"313_T"</span>, file <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-he-image">3. The HE-image<a class="anchor" aria-label="anchor" href="#the-he-image"></a>
</h2>
<p>The HE-image of your spatial sample is stored in slot <span class="citation">@images</span> of the <code>spata2</code> object.
Sample T313 is a glioblastoma with a prominent necrotic area in it’s
center.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotImageGgplot.html">plotImageGgplot</a></span><span class="op">(</span><span class="va">object_t313</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="spata-v2-image-annotations_files/figure-html/unnamed-chunk-4-1.png" alt="Fig.1 The HE-image." width="100%"><p class="caption">
Fig.1 The HE-image.
</p>
</div>
<p>To analyze the necrotic area we’ll use <strong>SPATA2</strong> image
annotation system.</p>
</div>
<div class="section level2">
<h2 id="creating-image-annotations">3. Creating image annotations<a class="anchor" aria-label="anchor" href="#creating-image-annotations"></a>
</h2>
<p>Image annotations are structures in histology image whose spatial
extent is captured in form of a polygon and saved in the
<code>spata2</code> object. For more details on how this is translated
into R-code see below. To add image annotations to the
<code>spata2</code> object you can make use of the function
<code><a href="../reference/createImageAnnotations.html">createImageAnnotations()</a></code>. This function lets you access an
interactive application in which you can encircle the structure or area
you want to annotate.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># interactively</span>
<span class="va">object</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createImageAnnotations.html">createImageAnnotations</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object_t313</span><span class="op">)</span>

<span class="co"># or manually </span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"image_annotations"</span><span class="op">)</span>

<span class="va">object</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/setImageAnnotation.html">setImageAnnotation</a></span><span class="op">(</span>
    object <span class="op">=</span> <span class="va">object_t313</span>,
    img_ann <span class="op">=</span> <span class="va">image_annotations</span><span class="op">$</span><span class="va">`313_T`</span><span class="op">[[</span><span class="st">"necrotic_center"</span><span class="op">]</span><span class="op">]</span>, 
    overwrite <span class="op">=</span> <span class="cn">TRUE</span>
    <span class="op">)</span></code></pre></div>
<div class="figure">
<img src="images/annotate_image_zooming.JPG" alt="Fig.2 The interface of createImageAnnotations()" width="100%"><p class="caption">
Fig.2 The interface of createImageAnnotations()
</p>
</div>
<div class="figure">
<img src="images/annotate_image_zooming2.JPG" alt="Fig.3 Zooming options allow to inspect the HE-image in detail." width="100%"><p class="caption">
Fig.3 Zooming options allow to inspect the HE-image in detail.
</p>
</div>
<div class="figure">
<img src="images/drawing.JPG" alt="Fig.4 Encircling the area of interest." width="100%"><p class="caption">
Fig.4 Encircling the area of interest.
</p>
</div>
<p>The left plot <em>Interaction</em> is where the magic happens. The
right plot is used for orientation if you want to zoom in and out.
Double click on the left image to start the drawing process. Double
click again to stop drawing. If you are using drawing mode
<em>Single</em> click on ‘Highlight’ to highlight the encircled area,
enter the tags you want to tag the annotation with, enter the ID with
which you want to name the annotation and click on ‘Add Image
Annotation’. If you are in drawing mode <em>Multiple</em> stopping the
drawing immediately highlights the encircled area. This allows to
quickly encircle multiple structures of the same kind that are tagged
with the same tags (e.g. multiple small vessel). The tab on the right
called ‘Added Image Annotations’ allows to visualize all image
annotations saved so far.</p>
<div class="figure">
<img src="images/drawn_enter_tags_and_name.JPG" alt="Fig.5 Area is encircled and can be added as an image annotation." width="100%"><p class="caption">
Fig.5 Area is encircled and can be added as an image annotation.
</p>
</div>
<p>Make sure to click on ‘Close application’ to return the
<code>spata2</code> object containing the results.</p>
</div>
<div class="section level2">
<h2 id="visualizing-image-annotations">4. Visualizing image annotations<a class="anchor" aria-label="anchor" href="#visualizing-image-annotations"></a>
</h2>
<p>To visualize the structures you have annotated use
<code><a href="../reference/plotImageAnnotations.html">plotImageAnnotations()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotImageAnnotations.html">plotImageAnnotations</a></span><span class="op">(</span>
  object <span class="op">=</span> <span class="va">object_t313</span>,
  ids <span class="op">=</span> <span class="st">"necrotic_center"</span>,
  expand <span class="op">=</span> <span class="fl">0.5</span>,
  square <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span></code></pre></div>
<div class="figure">
<img src="spata-v2-image-annotations_files/figure-html/unnamed-chunk-10-1.png" alt="Fig.6 Simple visualization of image annotations." width="50%"><p class="caption">
Fig.6 Simple visualization of image annotations.
</p>
</div>
<p>The function <code><a href="../reference/ggpLayerImgAnnOutline.html">ggpLayerImgAnnOutline()</a></code> creates an
additional layer that can be added to other surface plots created with
ggplot2. This is useful if you want to visualize the extent of certain
histological structures in relation to certain features or gene
expression.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># ggpLayer*functions create standalone ggproto objects </span>
<span class="co"># that can be used to customize other ggplots</span>
<span class="va">layer_necrotic</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/ggpLayerImgAnnOutline.html">ggpLayerImgAnnOutline</a></span><span class="op">(</span>
    object <span class="op">=</span> <span class="va">object_t313</span>, 
    ids <span class="op">=</span> <span class="st">"necrotic_center"</span>,
    fill <span class="op">=</span> <span class="st">"gray"</span>, 
    alpha <span class="op">=</span> <span class="fl">0.5</span>
    <span class="op">)</span>

<span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span>
  object <span class="op">=</span> <span class="va">object_t313</span>, 
  color_by <span class="op">=</span> <span class="st">"nCount_Spatial"</span>, 
  alpha_by <span class="op">=</span> <span class="st">"nCount_Spatial"</span>,
  transform_with <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nCount_Spatial <span class="op">=</span> <span class="va">log10</span><span class="op">)</span>,
  display_image <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span> 

<span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span>
  object <span class="op">=</span> <span class="va">object_t313</span>, 
  color_by <span class="op">=</span> <span class="st">"nCount_Spatial"</span>, 
  alpha_by <span class="op">=</span> <span class="st">"nCount_Spatial"</span>,
  transform_with <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nCount_Spatial <span class="op">=</span> <span class="va">log10</span><span class="op">)</span>,
  display_image <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span> <span class="op">+</span> 
  <span class="va">layer_necrotic</span></code></pre></div>
<div class="figure">
<img src="spata-v2-image-annotations_files/figure-html/unnamed-chunk-11-1.png" alt="Fig.7 Add the extent of image annotations to surface plots." width="50%"><img src="spata-v2-image-annotations_files/figure-html/unnamed-chunk-11-2.png" alt="Fig.7 Add the extent of image annotations to surface plots." width="50%"><p class="caption">
Fig.7 Add the extent of image annotations to surface plots.
</p>
</div>
</div>
<div class="section level2">
<h2 id="working-with-image-annotations">5. Working with image annotations<a class="anchor" aria-label="anchor" href="#working-with-image-annotations"></a>
</h2>
<p><strong>SPATA2</strong> offers several functions that allow to work
and program with image annotations. For that we’ll use an example that
contains many small image annotations and that is known to contain a
highly segregated hypoxic area.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotImageGgplot.html">plotImageGgplot</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object_t275</span><span class="op">)</span>

<span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span>
  object <span class="op">=</span> <span class="va">object_t275</span>,
  color_by <span class="op">=</span> <span class="st">"HM_HYPOXIA"</span>,
  display_image <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="../reference/ggpLayerFrameByCoords.html">ggpLayerFrameByImage</a></span><span class="op">(</span><span class="va">object_t275</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="spata-v2-image-annotations_files/figure-html/unnamed-chunk-12-1.png" alt="Fig.8 Glioblastoma sample T275 with a prominent hypoxia region." width="50%"><img src="spata-v2-image-annotations_files/figure-html/unnamed-chunk-12-2.png" alt="Fig.8 Glioblastoma sample T275 with a prominent hypoxia region." width="50%"><p class="caption">
Fig.8 Glioblastoma sample T275 with a prominent hypoxia region.
</p>
</div>
<div class="section level3">
<h3 id="image-handling-and-plotting">5.1 Image handling and plotting<a class="anchor" aria-label="anchor" href="#image-handling-and-plotting"></a>
</h3>
<p>We annotated five small vessel that we found in the HE-image using
<code><a href="../reference/createImageAnnotations.html">createImageAnnotations()</a></code> as well as a structure that we
assume to be an artifact. Note that the image annotations are provided
in the list <code>image_annotations</code> and that these annotations
are scaled for the low resolution image.</p>
<p>Arguments <code>expand</code> and <code>square</code> can be used to
specify how the cropped image sections are handled. Read the
documentation with <code><a href="../reference/plotImageAnnotations.html">?plotImageAnnotations</a></code> or
<code><a href="../reference/getImageAnnotations.html">?getImageAnnotations</a></code> for more information.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load example list </span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"image_annotations"</span><span class="op">)</span>

<span class="co"># set annotations</span>
<span class="va">object_t275</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/setImageAnnotation.html">setImageAnnotations</a></span><span class="op">(</span>
    object <span class="op">=</span> <span class="va">object_t275</span>,
    img_anns <span class="op">=</span> <span class="va">image_annotations</span><span class="op">[[</span><span class="st">"275_T"</span><span class="op">]</span><span class="op">]</span>,
    overwrite <span class="op">=</span> <span class="cn">TRUE</span>
    <span class="op">)</span>

<span class="co"># plot results (high resolution)</span>
<span class="fu"><a href="../reference/plotImageAnnotations.html">plotImageAnnotations</a></span><span class="op">(</span>
  object <span class="op">=</span> <span class="va">object_t275</span>,
  ids <span class="op">=</span> <span class="cn">NULL</span>, <span class="co"># no further specification of ids ..</span>
  tags <span class="op">=</span> <span class="cn">NULL</span>, <span class="co"># ... and tags includes all image annotations</span>
  expand <span class="op">=</span> <span class="fl">0.4</span>, <span class="co"># expand the image</span>
  square <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># force the image into a square</span>
  display_subtitle <span class="op">=</span> <span class="cn">TRUE</span>, 
  line_size <span class="op">=</span> <span class="fl">1</span>, 
  nrow <span class="op">=</span> <span class="fl">2</span>
  <span class="op">)</span></code></pre></div>
<div class="figure">
<img src="spata-v2-image-annotations_files/figure-html/unnamed-chunk-13-1.png" alt="Fig.9 All image annotations of sample T275 one by one in high resolution." width="100%"><p class="caption">
Fig.9 All image annotations of sample T275 one by one in high
resolution.
</p>
</div>
<p>For a visualization of many image annotations on a surface-ggplot you
can use <code><a href="../reference/ggpLayerImgAnnOutline.html">ggpLayerImgAnnOutline()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotImageGgplot.html">plotImageGgplot</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object_t275</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="../reference/ggpLayerImgAnnOutline.html">ggpLayerImgAnnOutline</a></span><span class="op">(</span>
    object <span class="op">=</span> <span class="va">object_t275</span>,
    line_size <span class="op">=</span> <span class="fl">1</span>, 
    line_color <span class="op">=</span> <span class="st">"red"</span>
    <span class="op">)</span></code></pre></div>
<div class="figure">
<img src="spata-v2-image-annotations_files/figure-html/ggpLayer2-1.png" alt="Fig.10 All image annotations of sample T275 projected on the whole image." width="100%"><p class="caption">
Fig.10 All image annotations of sample T275 projected on the whole
image.
</p>
</div>
</div>
<div class="section level3">
<h3 id="using-tags">5.2 Using tags<a class="anchor" aria-label="anchor" href="#using-tags"></a>
</h3>
<p>Comparing the localisation of each image annotation from Fig.10 in
Fig.11 it becomes apparent that we tagged vessel differently, depending
on their position. The tagging system of image annotations can be used
to conveniently extract and/or plot image annotations or information
thereof. E.g. in Fig.5, the image annotation has been tagged with
<em>necrotic</em> and <em>center</em>.</p>
<p>Input for argument tags specifies the tags of interest. Argument
<code>test</code> decides about how the specified tags are used to
select the image annotations of interest. There are three options:</p>
<ol style="list-style-type: decimal">
<li><p>Argument <code>test</code> set to <em>‘any’</em> or 1: To be
included, an image annotation must be tagged with at least one of the
input tags.</p></li>
<li><p>Argument <code>test</code> set to <em>‘all’</em> or 2: To be
included, an image annotation must be tagged with all of the input
tags.</p></li>
<li><p>Argument <code>test</code> set to <em>‘identical’</em> or 3: To
be included, an image annotation must be tagged with all of the input
tags and must not be tagged with anything else.</p></li>
<li><p>Argument <code>test</code> set to <em>not_identical</em> or
<em>4</em>: To be included, an image annotation must
<strong>not</strong> be tagged with the combination of input
tags.</p></li>
<li><p>Argument <code>test</code> set to <em>‘none’</em> or <em>5</em>:
To be included, an image annotation</p></li>
</ol>
<p>Note that the filtering process happens in addition to / after the
filtering by input for argument ids. This concept is exemplified in
Fig.12 with <code><a href="../reference/plotImageAnnotations.html">plotImageAnnotations()</a></code> but works the same for
all other image annotation related functions that extract image
annotations.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot on the left</span>
<span class="fu"><a href="../reference/plotImageAnnotations.html">plotImageAnnotations</a></span><span class="op">(</span>
  object <span class="op">=</span> <span class="va">object_t275</span>, 
  tags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"vessel"</span>, <span class="st">"in_hypoxia"</span><span class="op">)</span>,
  test <span class="op">=</span> <span class="st">"any"</span>, <span class="co"># annotations are kept as long as at least one of the tags fit's</span>
  expand <span class="op">=</span> <span class="fl">0.4</span>, 
  square <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span> 

<span class="co"># plot on the right</span>
<span class="fu"><a href="../reference/plotImageAnnotations.html">plotImageAnnotations</a></span><span class="op">(</span>
  object <span class="op">=</span> <span class="va">object_t275</span>, 
  tags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"vessel"</span>, <span class="st">"in_hypoxia"</span><span class="op">)</span>,
  test <span class="op">=</span> <span class="st">"all"</span>, <span class="co"># to be be kept, all specified tags must be included in the image annoation</span>
  expand <span class="op">=</span> <span class="fl">0.4</span>, 
  square <span class="op">=</span> <span class="cn">TRUE</span>, 
  ncol <span class="op">=</span> <span class="fl">3</span>,
  nrow <span class="op">=</span> <span class="fl">2</span>
<span class="op">)</span></code></pre></div>
<div class="figure">
<img src="spata-v2-image-annotations_files/figure-html/using_tags-1.png" alt="Fig.12 Using tags to specify the image annotations of interest." width="50%"><img src="spata-v2-image-annotations_files/figure-html/using_tags-2.png" alt="Fig.12 Using tags to specify the image annotations of interest." width="50%"><p class="caption">
Fig.12 Using tags to specify the image annotations of interest.
</p>
</div>
<p>Further functions that might be of interest when it comes to
integrate histological structures in the analysis or code writing:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># extracts the polygon data.frames that contains the border </span>
<span class="fu"><a href="../reference/getImgAnnOutlineDf.html">getImgAnnOutlineDf</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object_t275</span>, tags <span class="op">=</span> <span class="st">"vessel"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 30 x 4</span></span>
<span class="co">## <span style="color: #949494;"># Groups:   ids [5]</span></span>
<span class="co">##    ids       border     x     y</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> img_ann_1 outer  <span style="text-decoration: underline;">1</span>133. <span style="text-decoration: underline;">1</span>658.</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> img_ann_1 outer  <span style="text-decoration: underline;">1</span>126. <span style="text-decoration: underline;">1</span>644.</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> img_ann_1 outer  <span style="text-decoration: underline;">1</span>121. <span style="text-decoration: underline;">1</span>655.</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> img_ann_1 outer  <span style="text-decoration: underline;">1</span>132. <span style="text-decoration: underline;">1</span>659.</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> img_ann_1 outer  <span style="text-decoration: underline;">1</span>127. <span style="text-decoration: underline;">1</span>666.</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> img_ann_1 outer  <span style="text-decoration: underline;">1</span>122. <span style="text-decoration: underline;">1</span>652.</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> img_ann_2 outer  <span style="text-decoration: underline;">1</span>254. <span style="text-decoration: underline;">1</span>667.</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> img_ann_2 outer  <span style="text-decoration: underline;">1</span>253. <span style="text-decoration: underline;">1</span>670.</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> img_ann_2 outer  <span style="text-decoration: underline;">1</span>263. <span style="text-decoration: underline;">1</span>641.</span>
<span class="co">## <span style="color: #BCBCBC;">10</span> img_ann_2 outer  <span style="text-decoration: underline;">1</span>261. <span style="text-decoration: underline;">1</span>633.</span>
<span class="co">## <span style="color: #949494;"># i 20 more rows</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># although image annotations are primarily independent of </span>
<span class="co"># barcode spots you might want to know which of the barcode spots</span>
<span class="co"># are covered by certain annotations</span>
<span class="fu"><a href="../reference/getImgAnnBarcodes.html">getImgAnnBarcodes</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object_t275</span>, tags <span class="op">=</span> <span class="st">"vessel"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "GAAATACCTGCTGGCT-1" "TGGGCACGTTCTATGG-1" "ATCGGCAAGCAGTCCA-1"</span>
<span class="co">## [4] "CTTCGATTGCGCAAGC-1" "GTGCCTGAGACCAAAC-1"</span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="the-s4-imageannotation-class">6. The S4 <code>ImageAnnotation</code> class<a class="anchor" aria-label="anchor" href="#the-s4-imageannotation-class"></a>
</h2>
<p>Image annotations are abstracted in an S4 class named
<code>ImageAnnotation</code>. Use <code><a href="../reference/ImageAnnotation-class.html">?ImageAnnotation</a></code> to read
the description.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># extracts single image annotations</span>
<span class="va">img_ann</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getImageAnnotation.html">getImageAnnotation</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object_t275</span>, id <span class="op">=</span> <span class="st">"img_ann_1"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">img_ann</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "ImageAnnotation"</span>
<span class="co">## attr(,"package")</span>
<span class="co">## [1] "SPATA2"</span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">slotNames</span><span class="op">(</span><span class="va">img_ann</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "area"       "id"         "image"      "image_info" "info"      </span>
<span class="co">## [6] "misc"       "tags"</span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># extracts a list of image annotations</span>
<span class="va">img_anns</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getImageAnnotations.html">getImageAnnotations</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object_t275</span>, tags <span class="op">=</span> <span class="st">"vessel"</span>, test <span class="op">=</span> <span class="st">"any"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">img_anns</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "list"</span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">img_anns</span>, .f <span class="op">=</span> <span class="va">class</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $img_ann_1</span>
<span class="co">## [1] "ImageAnnotation"</span>
<span class="co">## attr(,"package")</span>
<span class="co">## [1] "SPATA2"</span>
<span class="co">## </span>
<span class="co">## $img_ann_2</span>
<span class="co">## [1] "ImageAnnotation"</span>
<span class="co">## attr(,"package")</span>
<span class="co">## [1] "SPATA2"</span>
<span class="co">## </span>
<span class="co">## $img_ann_3</span>
<span class="co">## [1] "ImageAnnotation"</span>
<span class="co">## attr(,"package")</span>
<span class="co">## [1] "SPATA2"</span>
<span class="co">## </span>
<span class="co">## $img_ann_4</span>
<span class="co">## [1] "ImageAnnotation"</span>
<span class="co">## attr(,"package")</span>
<span class="co">## [1] "SPATA2"</span>
<span class="co">## </span>
<span class="co">## $img_ann_5</span>
<span class="co">## [1] "ImageAnnotation"</span>
<span class="co">## attr(,"package")</span>
<span class="co">## [1] "SPATA2"</span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jan Kueckelhaus, Dieter-Henrik Heiland, Simon Frerich.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
