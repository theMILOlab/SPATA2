<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spatial segmentation vs. Image annotations • SPATA2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Spatial segmentation vs. Image annotations">
<meta property="og:description" content="SPATA2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SPATA2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/spata-v2-installation.html">Installation</a>
</li>
<li>
  <a href="../articles/spata-v2-spata-data.html">SPATAData</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Around the Spata-Object</li>
    <li>
      <a href="../articles/spata-v2-object-initiation-and-manipulation.html">Object Set Up and Manipulation</a>
    </li>
    <li>
      <a href="../articles/">Genes, Gene Sets and Features</a>
    </li>
    <li class="dropdown-header">Integrating Different Platforms</li>
    <li>
      <a href="../articles/spata-v2-cnv-analysis.html">Copy Number Variations</a>
    </li>
    <li>
      <a href="../articles/spata-v2-segmentation.html">Spatial Segmentation (Manual Annotation)</a>
    </li>
    <li>
      <a href="../articles/spata-v2-dea.html">Differential Expression Analysis</a>
    </li>
    <li>
      <a href="../articles/spata-v2-gsea.html">Gene Set Enrichment Analysis</a>
    </li>
    <li class="dropdown-header">Gradient Screening</li>
    <li>
      <a href="../articles/spata-v2-trajectory-analysis.html">Spatial Trajectories</a>
    </li>
    <li>
      <a href="../articles/spata-v2-spatial-trajectory-screening.html">Spatial Trajectory Screening</a>
    </li>
    <li>
      <a href="../articles/spata-v2-image-annotations.html">Image Annotations</a>
    </li>
    <li>
      <a href="../articles/spata-v2-image-annotation-screening.html">Image Annotation Screening</a>
    </li>
    <li class="dropdown-header">Visualization</li>
    <li>
      <a href="../articles/spata-v2-plotting-surface.html">Surface Plotting</a>
    </li>
    <li>
      <a href="../articles/spata-v2-plotting-misc.html">Miscellaneous</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Code &amp; Concept
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cc-spatial-measures.html">Spatial Measures</a>
    </li>
    <li>
      <a href="../articles/cc-spatial-segmentation-vs-image-annotation.html">Spatial Segmentation vs. Image Annotations</a>
    </li>
    <li>
      <a href="../articles/cc-spatial-trajectory-screening.html">Spatial Trajectory Screening</a>
    </li>
    <li>
      <a href="../articles/cc-image-annotation-screening.html">Image Annotation Screening</a>
    </li>
    <li>
      <a href="../articles/cc-model-fitting-in-spatial-transcriptomic-studies.html">Model Fitting</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Spatial segmentation vs. Image annotations</h1>
                        <h4 data-toc-skip class="author">Jan
Kueckelhaus</h4>
            
            <h4 data-toc-skip class="date">2022-08-20</h4>
      
      
      <div class="hidden name"><code>cc-spatial-segmentation-vs-image-annotations.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="prerequisites">1. Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<p>None.</p>
</div>
<div class="section level2">
<h2 id="introduction-overview">2. Introduction &amp; overview<a class="anchor" aria-label="anchor" href="#introduction-overview"></a>
</h2>
<p><strong>SPATA2</strong> allows to work closely with the underlying
histology of the tissue via spatial segmentation with the function
<code><a href="../reference/createSpatialSegmentation.html">createSpatialSegmentation()</a></code> and via image annotations with
the function <code><a href="../reference/createImageAnnotations.html">createImageAnnotations()</a></code>. In both cases areas
of interest are interactively encircled by <em>drawing</em> on the
image. How the annotated areas are processed and how both options can be
used in downstream analysis differs, however. This vignette explains the
difference between both options.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://themilolab.com/" class="external-link">SPATA2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SPATAData</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>

<span class="va">object_t269</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SPATAData/man/downloadSpataObject.html" class="external-link">downloadSpataObject</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="st">"269_T"</span><span class="op">)</span>
<span class="va">object_t313</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SPATAData/man/downloadSpataObject.html" class="external-link">downloadSpataObject</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="st">"313_T"</span><span class="op">)</span>

<span class="fu"><a href="../reference/plotImageGgplot.html">plotImageGgplot</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object_t269</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"T269"</span><span class="op">)</span>

<span class="fu"><a href="../reference/plotImageGgplot.html">plotImageGgplot</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object_t313</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"T313"</span><span class="op">)</span></code></pre></div>
<p><img src="cc-spatial-segmentation-vs-image-annotations_files/figure-html/images-1.png" width="50%"><img src="cc-spatial-segmentation-vs-image-annotations_files/figure-html/images-2.png" width="50%"></p>
</div>
<div class="section level2">
<h2 id="spatial-segmentation">3. Spatial segmentation<a class="anchor" aria-label="anchor" href="#spatial-segmentation"></a>
</h2>
<p>In transcriptomic studies grouping variables are usually created by
clustering. Spatial segmentation is used to create grouping variables
that group the barcode-spots based on the area in which they are
located.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># extract all grouping variables of the object</span>
<span class="va">feature_df</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/getFeatureDf.html">getFeatureDf</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object_t269</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">barcodes</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html" class="external-link">where</a></span><span class="op">(</span><span class="va">is.factor</span><span class="op">)</span><span class="op">)</span>

<span class="co"># show results</span>
<span class="va">feature_df</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 3,213 x 2</span></span>
<span class="co">##    barcodes           seurat_clusters</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>          </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> AAACAAGTATCTCCCA-1 2              </span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> AAACACCAATAACTGC-1 0              </span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> AAACAGAGCGACTCCT-1 5              </span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> AAACATTTCCCGGATT-1 5              </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> AAACCCGAACGAAATC-1 2              </span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> AAACCGGGTAGGTACC-1 7              </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> AAACCGTTCGTCCAGG-1 0              </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> AAACCTAAGCAGCCGG-1 1              </span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> AAACCTCATGAAGTTG-1 7              </span>
<span class="co">## <span style="color: #BCBCBC;">10</span> AAACGAGACGGTTGAT-1 1              </span>
<span class="co">## <span style="color: #949494;"># i 3,203 more rows</span></span></code></pre>
<p>To group barcode-spots based on the histology they cover
<code>createSpatialSegmentations()</code> allows to interactively
encircle the different regions on the image by drawing the respective
borders. The barcode-spots that fall into an encircled area can then be
labeled. The image below is a screenshot from the interface of
<code><a href="../reference/createSpatialSegmentation.html">createSpatialSegmentation()</a></code> where the left side of the
sample is about to be labeled <em>tumor</em> within the grouping
variable <em>histology</em>.</p>
<p><img src="images/create_segmentation_screenshot.JPG" width="100%"></p>
<p>This way the surface of the tissue is segmented bit by bit. The
resulting grouping variables are stored in the feature data.frame.
Examples of segmentations are provided in the list
<code>spatial_segmentations</code> as part of the
<strong>SPATA2</strong> package in form of data.frames that contain the
id variable <em>barcodes</em> and the grouping variable
<em>histology</em>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load example list</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"spatial_segmentations"</span><span class="op">)</span>

<span class="va">segmentation_df</span> <span class="op">&lt;-</span> <span class="va">spatial_segmentations</span><span class="op">[[</span><span class="st">"269_T"</span><span class="op">]</span><span class="op">]</span>

<span class="co"># show results</span>
<span class="va">segmentation_df</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 3,213 x 2</span></span>
<span class="co">##    barcodes           histology  </span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> AAACAAGTATCTCCCA-1 infiltrated</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> AAACACCAATAACTGC-1 tumor      </span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> AAACAGAGCGACTCCT-1 infiltrated</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> AAACATTTCCCGGATT-1 infiltrated</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> AAACCCGAACGAAATC-1 infiltrated</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> AAACCGGGTAGGTACC-1 tumor      </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> AAACCGTTCGTCCAGG-1 tumor      </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> AAACCTAAGCAGCCGG-1 infiltrated</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> AAACCTCATGAAGTTG-1 tumor      </span>
<span class="co">## <span style="color: #BCBCBC;">10</span> AAACGAGACGGTTGAT-1 infiltrated</span>
<span class="co">## <span style="color: #949494;"># i 3,203 more rows</span></span></code></pre>
<p>Variables created with spatial segmentation are grouping variables
and can be used like any other grouping variable.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># add example segmentation variable to features</span>
<span class="va">object_t269</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/addFeatures.html">addFeatures</a></span><span class="op">(</span>
    object <span class="op">=</span> <span class="va">object_t269</span>,
    feature_df <span class="op">=</span> <span class="va">segmentation_df</span>
  <span class="op">)</span>

<span class="co"># show results</span>
<span class="fu"><a href="../reference/getFeatureDf.html">getFeatureDf</a></span><span class="op">(</span><span class="va">object_t269</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 3,213 x 6</span></span>
<span class="co">##    barcodes     sample nCount_Spatial nFeature_Spatial seurat_clusters histology</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> AAACAAGTATC~ 269_T            <span style="text-decoration: underline;">2</span>984             <span style="text-decoration: underline;">1</span>760 2               infiltra~</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> AAACACCAATA~ 269_T           <span style="text-decoration: underline;">14</span>812             <span style="text-decoration: underline;">5</span>452 0               tumor    </span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> AAACAGAGCGA~ 269_T            <span style="text-decoration: underline;">2</span>393             <span style="text-decoration: underline;">1</span>516 5               infiltra~</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> AAACATTTCCC~ 269_T            <span style="text-decoration: underline;">4</span>870             <span style="text-decoration: underline;">2</span>575 5               infiltra~</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> AAACCCGAACG~ 269_T            <span style="text-decoration: underline;">5</span>731             <span style="text-decoration: underline;">2</span>781 2               infiltra~</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> AAACCGGGTAG~ 269_T           <span style="text-decoration: underline;">19</span>525             <span style="text-decoration: underline;">6</span>066 7               tumor    </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> AAACCGTTCGT~ 269_T           <span style="text-decoration: underline;">11</span>463             <span style="text-decoration: underline;">4</span>523 0               tumor    </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> AAACCTAAGCA~ 269_T            <span style="text-decoration: underline;">9</span>221             <span style="text-decoration: underline;">3</span>966 1               infiltra~</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> AAACCTCATGA~ 269_T           <span style="text-decoration: underline;">12</span>689             <span style="text-decoration: underline;">4</span>782 7               tumor    </span>
<span class="co">## <span style="color: #BCBCBC;">10</span> AAACGAGACGG~ 269_T            <span style="text-decoration: underline;">1</span>168              889 1               infiltra~</span>
<span class="co">## <span style="color: #949494;"># i 3,203 more rows</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot sgementation variable like any other variable</span>
<span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object_t269</span>, color_by <span class="op">=</span> <span class="st">"histology"</span>, pt_clrp <span class="op">=</span> <span class="st">"npg"</span><span class="op">)</span>

<span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object_t269</span>, color_by <span class="op">=</span> <span class="st">"seurat_clusters"</span>, pt_clrp <span class="op">=</span> <span class="st">"lo"</span><span class="op">)</span></code></pre></div>
<p><img src="cc-spatial-segmentation-vs-image-annotations_files/figure-html/unnamed-chunk-5-1.png" width="50%"><img src="cc-spatial-segmentation-vs-image-annotations_files/figure-html/unnamed-chunk-5-2.png" width="50%"></p>
<p>This way, information that is given by the image can be integrated to
find genes specific for histology using DEA.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># run DEA based on histology</span>
<span class="va">object_t269</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runDEA.html">runDeAnalysis</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object_t269</span>, across <span class="op">=</span> <span class="st">"histology"</span><span class="op">)</span>

<span class="fu"><a href="../reference/plotDeaVolcano.html">plotDeaVolcano</a></span><span class="op">(</span>
  object <span class="op">=</span> <span class="va">object_t269</span>,
  across <span class="op">=</span> <span class="st">"histology"</span>, 
  use_pseudolog <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span></code></pre></div>
<p><img src="cc-spatial-segmentation-vs-image-annotations_files/figure-html/unnamed-chunk-7-1.png" width="100%"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotSurfaceComparison.html">plotSurfaceComparison</a></span><span class="op">(</span>
  object <span class="op">=</span> <span class="va">object_t269</span>,
  color_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B2M"</span>, <span class="st">"MBP"</span>, <span class="st">"SNAP25"</span><span class="op">)</span>, 
  nrow <span class="op">=</span> <span class="fl">1</span>
<span class="op">)</span></code></pre></div>
<p><img src="cc-spatial-segmentation-vs-image-annotations_files/figure-html/unnamed-chunk-8-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="image-annotations">4. Image annotations<a class="anchor" aria-label="anchor" href="#image-annotations"></a>
</h2>
<p>Image annotations work more closely with the image itself. Instead of
being translated in grouping variables they are stored in S4 objects of
class <code>ImageAnnotation</code>. Thus, every single annotated area
stands for itself. One and the same area can be included in several
image annotations. The image below shows a screenshot from the interface
of the function <code><a href="../reference/createImageAnnotations.html">createImageAnnotations()</a></code>. It shows how the
annotation <em>necrotic_center</em> has already been drawn. And
regardless of the spatial extent of the image annotation
<em>necrotic_center</em> additional image annotations are drawn to
encircle vessels that might or might not lie inside of previously
annotated necrotic area. As every image annotation stands for itself
there is no conflict. Grouping variables would not allow that as every
barcode-spot (every x/y position) can only be labeled/annotated one time
within one and the same grouping variable.</p>
<p><img src="images/create_image_annotations_screenshot.JPG" width="100%"></p>
<p>Example image annotations are provided in the list
<code>image_annotations</code> as part of the <strong>SPATA2</strong>
package.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load example list</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"image_annotations"</span><span class="op">)</span>

<span class="va">necrotic_img_ann</span> <span class="op">&lt;-</span> <span class="va">image_annotations</span><span class="op">[[</span><span class="st">"313_T"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"necrotic_center"</span><span class="op">]</span><span class="op">]</span>

<span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">necrotic_img_ann</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "ImageAnnotation"</span>
<span class="co">## attr(,"package")</span>
<span class="co">## [1] "SPATA2"</span></code></pre>
<p>Use the function <code><a href="../reference/setImageAnnotation.html">setImageAnnotation()</a></code> to set the example
annotation or create your own with
<code><a href="../reference/createImageAnnotations.html">createImageAnnotations()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">object_t313</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/setImageAnnotation.html">setImageAnnotation</a></span><span class="op">(</span>
    object <span class="op">=</span> <span class="va">object_t313</span>,
    img_ann <span class="op">=</span> <span class="va">necrotic_img_ann</span>,
    overwrite <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>

<span class="co"># plot results</span>
<span class="fu"><a href="../reference/plotImageAnnotations.html">plotImageAnnotations</a></span><span class="op">(</span>
  object <span class="op">=</span> <span class="va">object_t313</span>, 
  ids <span class="op">=</span> <span class="st">"necrotic_center"</span>, 
  expand <span class="op">=</span> <span class="fl">0.2</span>, 
  alpha <span class="op">=</span> <span class="fl">0</span>
<span class="op">)</span></code></pre></div>
<p><img src="cc-spatial-segmentation-vs-image-annotations_files/figure-html/unnamed-chunk-11-1.png" width="50%"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">necrotic_img_ann</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/getImageAnnotation.html">getImageAnnotation</a></span><span class="op">(</span>
    object <span class="op">=</span> <span class="va">object_t313</span>,
    id <span class="op">=</span> <span class="st">"necrotic_center"</span>,
    add_image <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># use the area and the image to create a cropped image</span>
    expand <span class="op">=</span> <span class="fl">0</span> <span class="co"># manipulate the way how the image is cropped</span>
  <span class="op">)</span>

<span class="co"># show results (S4 object)</span>
<span class="va">necrotic_img_ann</span></code></pre></div>
<pre><code><span class="co">## An object of class 'ImageAnnotation' named 'necrotic_center'. Tags: necrotic.</span></code></pre>
<p>The S4 object contains a variety of information about the annotated
area. The respective areas can be extracted as a cropped images and can
be used as input for image processing, neural network analysis etc.
Depending on the input for argument <code>expand</code> the cropped
image section in slot <code>@image</code> either contains only what is
necessary to capture the annotated area or is expanded. For more
information on the S4 object <code>ImageAnnotation</code> read the
documentation via <code><a href="../reference/ImageAnnotation-class.html">?ImageAnnotation</a></code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the image (`expand` = 0)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">necrotic_img_ann</span><span class="op">@</span><span class="va">image</span><span class="op">)</span></code></pre></div>
<p><img src="cc-spatial-segmentation-vs-image-annotations_files/figure-html/unnamed-chunk-13-1.png" width="50%"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># the extracted image</span>
<span class="va">necrotic_img_ann</span><span class="op">@</span><span class="va">image</span></code></pre></div>
<pre><code><span class="co">## Image </span>
<span class="co">##   colorMode    : Color </span>
<span class="co">##   storage.mode : double </span>
<span class="co">##   dim          : 788 829 4 </span>
<span class="co">##   frames.total : 4 </span>
<span class="co">##   frames.render: 1 </span>
<span class="co">## </span>
<span class="co">## imageData(object)[1:5,1:6,1]</span>
<span class="co">##           [,1]      [,2]      [,3]      [,4]      [,5]      [,6]</span>
<span class="co">## [1,] 0.6705882 0.8901961 0.8235294 0.4078431 0.7882353 0.8901961</span>
<span class="co">## [2,] 0.8000000 0.8235294 0.6627451 0.6000000 0.7019608 0.9176471</span>
<span class="co">## [3,] 0.7019608 0.8078431 0.6666667 0.5921569 0.7725490 0.9803922</span>
<span class="co">## [4,] 0.8549020 0.8901961 0.6274510 0.2823529 0.6980392 0.9686275</span>
<span class="co">## [5,] 0.9098039 0.8901961 0.6862745 0.0000000 0.3803922 0.9529412</span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># the center of the annotation</span>
<span class="fu"><a href="../reference/getImgAnnCenter.html">getImgAnnCenter</a></span><span class="op">(</span><span class="va">necrotic_img_ann</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##         x         y </span>
<span class="co">##  789.3377 1078.9569</span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># the vertices of the drawn polygon</span>
<span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">necrotic_img_ann</span><span class="op">@</span><span class="va">area</span>, .f <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">.x</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $outer</span>
<span class="co">## <span style="color: #949494;"># A tibble: 10 x 2</span></span>
<span class="co">##        x     y</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>  512. <span style="text-decoration: underline;">1</span>378.</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>  512. <span style="text-decoration: underline;">1</span>363.</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>  510. <span style="text-decoration: underline;">1</span>354.</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>  505. <span style="text-decoration: underline;">1</span>350.</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>  505. <span style="text-decoration: underline;">1</span>347.</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>  500. <span style="text-decoration: underline;">1</span>341.</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>  497. <span style="text-decoration: underline;">1</span>334.</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>  497. <span style="text-decoration: underline;">1</span>330.</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>  497. <span style="text-decoration: underline;">1</span>323.</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>  500. <span style="text-decoration: underline;">1</span>312.</span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># the barcodes that fall into the area</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">necrotic_img_ann</span><span class="op">@</span><span class="va">misc</span><span class="op">$</span><span class="va">barcodes</span>, <span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  [1] "AAACAGGGTCTATATT-1" "AAACCGGGTAGGTACC-1" "AAACCGTTCGTCCAGG-1"</span>
<span class="co">##  [4] "AAACCTCATGAAGTTG-1" "AAACTTGCAAACGTAT-1" "AAAGGCTACGGACCAT-1"</span>
<span class="co">##  [7] "AAAGGCTCTCGCGCCG-1" "AAAGGGCAGCTTGAAT-1" "AAAGTAGCATTGCTCA-1"</span>
<span class="co">## [10] "AAATCGTGTACCACAA-1"</span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># all slot names</span>
<span class="fu">slotNames</span><span class="op">(</span><span class="va">necrotic_img_ann</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "area"       "id"         "image"      "image_info" "info"      </span>
<span class="co">## [6] "misc"       "tags"</span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># slot classes</span>
<span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span>
  .x <span class="op">=</span> <span class="fu">slotNames</span><span class="op">(</span><span class="va">necrotic_img_ann</span><span class="op">)</span>,
  .f <span class="op">=</span> <span class="op">~</span> <span class="fu">slot</span><span class="op">(</span><span class="va">necrotic_img_ann</span>, <span class="va">.x</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span>nm <span class="op">=</span><span class="fu">slotNames</span><span class="op">(</span><span class="va">necrotic_img_ann</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $area</span>
<span class="co">## [1] "list"</span>
<span class="co">## </span>
<span class="co">## $id</span>
<span class="co">## [1] "character"</span>
<span class="co">## </span>
<span class="co">## $image</span>
<span class="co">## [1] "Image"</span>
<span class="co">## attr(,"package")</span>
<span class="co">## [1] "EBImage"</span>
<span class="co">## </span>
<span class="co">## $image_info</span>
<span class="co">## [1] "list"</span>
<span class="co">## </span>
<span class="co">## $info</span>
<span class="co">## [1] "list"</span>
<span class="co">## </span>
<span class="co">## $misc</span>
<span class="co">## [1] "list"</span>
<span class="co">## </span>
<span class="co">## $tags</span>
<span class="co">## [1] "character"</span></code></pre>
</div>
<div class="section level2">
<h2 id="converting-image-annotations-to-spatial-segmentation">5. Converting image annotations to spatial segmentation<a class="anchor" aria-label="anchor" href="#converting-image-annotations-to-spatial-segmentation"></a>
</h2>
<p>If you have annotated several structures and areas on the image via
image annotations and you want to create a spatial segmentation variable
from them you can use <code><a href="../reference/imageAnnotationToSegmentation.html">imageAnnotationToSegmentation()</a></code>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">object_t313</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/imageAnnotationToSegmentation.html">imageAnnotationToSegmentation</a></span><span class="op">(</span>
    object <span class="op">=</span> <span class="va">object_t313</span>, 
    ids <span class="op">=</span> <span class="st">"necrotic_center"</span>,
    segmentation_name <span class="op">=</span> <span class="st">"histology_ia"</span>, <span class="co"># name of the grouping variable</span>
    inside <span class="op">=</span> <span class="st">"necrotic"</span>, <span class="co"># label the barcode spots inside the image annoation(s)</span>
    outside <span class="op">=</span> <span class="st">"vivid"</span>, <span class="co"># label the barcode spots outsid of the image annotation(s)</span>
    overwrite <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>

<span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object_t313</span>, color_by <span class="op">=</span> <span class="st">"histology_ia"</span>, pt_clrp <span class="op">=</span> <span class="st">"npg"</span><span class="op">)</span></code></pre></div>
<p><img src="cc-spatial-segmentation-vs-image-annotations_files/figure-html/unnamed-chunk-15-1.png" width="50%"></p>
<p>The binary segmentation/grouping variable is stored in the feature
data as any other grouping variable.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/getFeatureDf.html">getFeatureDf</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object_t313</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">barcodes</span>, <span class="va">histology_ia</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 3,517 x 2</span></span>
<span class="co">##    barcodes           histology_ia</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> AAACAAGTATCTCCCA-1 vivid       </span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> AAACAATCTACTAGCA-1 vivid       </span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> AAACACCAATAACTGC-1 vivid       </span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> AAACAGAGCGACTCCT-1 vivid       </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> AAACAGCTTTCAGAAG-1 vivid       </span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> AAACAGGGTCTATATT-1 necrotic    </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> AAACATGGTGAGAGGA-1 vivid       </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> AAACCCGAACGAAATC-1 vivid       </span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> AAACCGGGTAGGTACC-1 necrotic    </span>
<span class="co">## <span style="color: #BCBCBC;">10</span> AAACCGTTCGTCCAGG-1 necrotic    </span>
<span class="co">## <span style="color: #949494;"># i 3,507 more rows</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jan Kueckelhaus, Dieter-Henrik Heiland.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
